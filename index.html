<!DOCTYPE html>
<html lang="it" data-theme="auto">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>17/19 Urban Bistrot ‚Ä¢ Techno ‚Ä¢ Electro ‚Ä¢ House</title>
<meta name="description" content="17/19 Urban Bistrot Roma. DJ set in vinile curated by Riccardo Battaglia. Colazioni, pranzi, cene e cocktail signature." />
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#0b0b0b" media="(prefers-color-scheme: dark)">
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet"/>

<style>
/* ===================== TOKENS (mobile-first) ===================== */
:root{
  --bg:#0b0b0b; --fg:#ffffff; --muted:#9ca3af; --line:#1f1f1f;
  --accent:#ff1f3d; --accent-fg:#000;
  --chip:#121212; --chip-fg:#e5e7eb;
  --radius:16px; --pad:clamp(14px,4vw,28px); --max:1120px;
  --blur:18px;
}
html[data-theme="light"]{
  --bg:#ffffff; --fg:#0b0b0b; --muted:#6b7280; --line:#e5e7eb;
  --accent:#ff1f3d; --accent-fg:#fff;
  --chip:#f4f4f5; --chip-fg:#0b0b0b;
}

/* ===================== BASE ===================== */
*{box-sizing:border-box}
html,body{margin:0;max-width:100%}
body{background:var(--bg);color:var(--fg);font-family:'Inter',system-ui,sans-serif;line-height:1.6}
img{max-width:100%;display:block}
.container{max-width:var(--max);margin-inline:auto;padding-inline:var(--pad)}
section{padding:18px 0}
.grid{display:grid;gap:14px}
.grid-2{grid-template-columns:1fr}
@media (min-width:768px){ .grid-2{grid-template-columns:1.2fr .8fr} }

header{position:fixed;inset:0 0 auto;background:transparent;border-bottom:0;z-index:100}
header.header--solid{background:color-mix(in oklab,var(--bg) 85%,transparent);border-bottom:1px solid var(--line);backdrop-filter:saturate(140%) blur(8px)}
nav{display:flex;align-items:center;justify-content:space-between;height:60px}
.brand{display:flex;align-items:center;gap:10px;color:inherit;text-decoration:none}
.brand img{height:46px}
@media (min-width:768px){ .brand img{height:56px} }
.nav-desktop{display:none;gap:14px;align-items:center;list-style:none;margin:0;padding:0}
@media (min-width:768px){ .nav-desktop{display:flex} }
.pill{display:inline-flex;align-items:center;gap:.5rem;padding:.55rem .9rem;border:1px solid var(--line);border-radius:999px;text-decoration:none;font-weight:800;background:var(--chip);color:var(--chip-fg)}
.pill--accent{background:var(--accent);border-color:var(--accent);color:var(--accent-fg)}
.toggle,.menu-toggle{width:42px;height:42px;border:1px solid var(--line);border-radius:12px;background:var(--chip);display:grid;place-items:center;cursor:pointer}
.menu-toggle span,.menu-toggle span::before,.menu-toggle span::after{display:block;width:18px;height:2px;background:var(--fg);content:"";position:relative}
.menu-toggle span::before{position:absolute;top:-6px}
.menu-toggle span::after{position:absolute;top:6px}
.only-desktop{display:none}
@media (min-width:768px){ .only-desktop{display:inline-flex} }

/* Sheet menu */
.sheet{position:fixed;inset:0;background:rgba(0,0,0,.6);opacity:0;pointer-events:none;z-index:999;transition:opacity .25s}
.sheet.active{opacity:1;pointer-events:auto}
.sheet__panel{position:absolute;inset:0;display:grid;grid-template-rows:auto 1fr}
.sheet__close{position:absolute;top:12px;right:12px;width:44px;height:44px;border-radius:12px;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.08);color:#fff;font-size:24px;font-weight:900;display:grid;place-items:center;cursor:pointer;backdrop-filter: blur(6px)}
.sheet__inner{display:grid;place-items:center;height:100%;padding:28px}
.sheet__list{list-style:none;display:grid;gap:12px;text-align:center;margin:0;padding:0}
.sheet__list a{display:block;padding:10px 14px;border-radius:14px;text-decoration:none;color:#fff;font-weight:900;font-size:clamp(1.3rem,5vw,2.3rem)}
.sheet__list a:hover{background:rgba(255,255,255,.08)}
.sheet__cta{display:inline-flex;margin-top:16px}

/* Hero */
.hero{padding:72px 0 18px}
h1{font-family:'Montserrat',system-ui,sans-serif;font-weight:900;text-transform:uppercase;letter-spacing:.01em;font-size:clamp(2rem,8vw,3.4rem);line-height:1.1;margin:10px 0}
.tag{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--line);border-radius:999px;padding:6px 10px;font-weight:800;color:var(--muted);background:var(--chip);max-width:100%;white-space:normal;flex-wrap:wrap;overflow-wrap:anywhere}

/* Cards */
.card{border:1px solid var(--line);border-radius:16px;padding:14px;background:color-mix(in oklab,var(--bg) 96%,transparent)}
.block-title{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.block-title h3{font-family:'Montserrat',system-ui,sans-serif;font-size:1rem;margin:0;letter-spacing:.02em}
.meta{color:var(--muted);font-size:.95rem}

/* Mini time cards */
.time-cards{display:grid;grid-template-columns:1fr;gap:10px;margin-top:6px}
@media (min-width:420px){ .time-cards{grid-template-columns:repeat(2,1fr)} }
.time-card{display:flex;align-items:center;justify-content:space-between;gap:10px;border:1px solid var(--line);border-radius:14px;padding:10px 12px;background:color-mix(in oklab,var(--bg) 98%,transparent)}
.time-card .l{display:flex;align-items:center;gap:8px}
.time-card .i{display:grid;place-items:center;width:28px;height:28px;border-radius:10px;background:var(--chip);border:1px solid var(--line)}

/* Poster */
.poster-frame{position:relative;border:1px solid var(--line);border-radius:20px;background:var(--bg);overflow:hidden}
.poster-inner{position:relative;padding:clamp(16px,4vw,26px)}
.poster-head{display:flex;flex-direction:column;align-items:center;text-align:center;gap:4px}
.poster-head .venue{font-weight:900;letter-spacing:.10em;text-transform:uppercase;font-size:.98rem}
.poster-head .series{font-family:'Montserrat',system-ui,sans-serif;font-weight:900;letter-spacing:.06em;text-transform:uppercase;font-size:clamp(1.8rem,6.5vw,3rem);line-height:1.05}
.poster-head .date{font-weight:900;letter-spacing:.10em;text-transform:uppercase;font-size:clamp(.9rem,3.2vw,1.2rem)}
.poster-head .tagline{margin-top:2px;font-weight:900;letter-spacing:.10em;text-transform:uppercase;color:var(--fg);font-size:.92rem}
.poster-head .curated{color:var(--muted);font-weight:700;letter-spacing:.08em;text-transform:uppercase;font-size:.85rem}
.poster-canvas{position:relative;margin-top:clamp(14px,3vw,22px);height:clamp(320px,56vw,480px);background:color-mix(in oklab,var(--chip) 94%,transparent);border:1px solid var(--line);border-radius:14px;overflow:hidden; touch-action:none; contain:layout paint; overscroll-behavior:contain}
.poster-svg{position:absolute;inset:0;color:var(--fg);z-index:0;opacity:.08}

/* Bouncer labels */
.bouncer{
  position:absolute;display:inline-block;padding:.16em .44em;border-radius:6px;
  font-weight:900;letter-spacing:.06em;text-transform:uppercase;white-space:nowrap;
  user-select:none; will-change:transform; box-shadow:0 0 0 1px var(--line) inset;
  cursor:grab; touch-action:none; transform:translate3d(0,0,0);
  background:color-mix(in oklab, var(--bg) 94%, transparent);
}
.bouncer .dot{display:inline-block;width:6px;height:6px;border-radius:2px;background:var(--fg);margin-right:8px;vertical-align:middle}
.bouncer *{pointer-events:none}
.bouncer--dragging{cursor:grabbing; box-shadow:0 6px 18px rgba(0,0,0,.22), 0 0 0 1px var(--line) inset}

/* Poster logos */
.poster-logos{position:absolute;left:0;right:0;bottom:0;padding:10px;border-top:1px solid var(--line);display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap}

/* Eventi & altri blocchi (compatti) */
.event{display:grid;gap:8px;align-items:start;border:1px solid var(--line);border-radius:16px;padding:12px;background:color-mix(in oklab,var(--bg) 96%,transparent)}
.event__title{font-weight:900}
.event__top{display:flex;align-items:center;justify-content:space-between;gap:10px}
.event__date{min-width:66px;text-align:center;border:1px solid var(--line);border-radius:12px;padding:6px 8px;background:var(--chip)}
.event__dow{font-weight:900}
.event__day{font-size:1.2rem;font-weight:900;line-height:1}
.event__info{display:flex;flex-wrap:wrap;gap:8px;color:var(--muted);font-size:.95rem}

.gallery{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
@media (min-width:768px){ .gallery{grid-template-columns:repeat(4,1fr)} }
.gallery a{position:relative;border:1px solid var(--line);border-radius:12px;overflow:hidden;background:var(--chip)}
.credit{position:absolute;left:8px;bottom:8px;background:rgba(0,0,0,.55);color:#fff;padding:4px 6px;border-radius:8px;font-size:.75rem}

footer{border-top:1px solid var(--line);padding:26px 0;color:var(--muted);text-align:center}

/* Reveal */
.reveal{opacity:0;transform:translateY(14px);transition:opacity .45s, transform .45s}
.reveal.active{opacity:1;transform:translateY(0)}

/* Toast (easter egg) */
.toast{
  position:absolute; left:12px; top:12px; z-index:5;
  display:none; max-width:min(92%, 320px);
  background:color-mix(in oklab, var(--bg) 82%, transparent);
  color:var(--fg); border:1px solid var(--line); border-radius:14px; padding:12px 14px;
  backdrop-filter: blur(var(--blur)); box-shadow:0 10px 24px rgba(0,0,0,.25);
}
.toast.show{display:block; animation:toastIn .24s ease-out both}
.toast h4{margin:.1rem 1.8rem .25rem 0; font-size:1rem}
.toast p{margin:.25rem 0 .35rem;font-size:.92rem}
.toast .tips{margin:.2rem 0 0 .9rem; padding-left:.2rem; font-size:.9rem; line-height:1.45}
.toast .x{position:absolute;right:8px;top:6px;border:1px solid var(--line);background:var(--chip);color:var(--chip-fg);border-radius:10px;width:26px;height:26px;display:grid;place-items:center;font-weight:900;cursor:pointer}
@keyframes toastIn{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:translateY(0)}}

/* Mobile overflow guard */
html,body{overflow-x:hidden}
</style>
</head>
<body>
<header>
  <div class="container">
    <nav aria-label="principale">
      <a class="brand" href="#">
        <img class="logo" src="https://cdn.shopify.com/s/files/1/0887/8332/3459/files/1719logobianco.svg?v=1755104086" alt="17/19 Urban Bistrot"/>
      </a>
      <ul class="nav-desktop">
        <li><a href="#about">About</a></li>
        <li><a href="#menu">Menu</a></li>
        <li><a href="#music">Musica</a></li>
        <li><a href="#events">Eventi</a></li>
        <li><a href="#gallery">Gallery</a></li>
        <li><a href="#contact">Contatti</a></li>
        <li><a class="pill pill--accent" href="https://wa.me/393298252092?text=Ciao%2017%2F19%20Urban%20Bistrot%2C%20vorrei%20prenotare">Prenota</a></li>
        <li class="only-desktop"><button id="themeToggle" class="toggle" aria-label="Tema"></button></li>
        <li class="only-desktop"><button class="menu-toggle" id="menuToggleD" aria-label="Apri/chiudi menu"><span></span></button></li>
      </ul>
      <div class="only-mobile" style="display:inline-flex;gap:8px">
        <button id="themeToggleM" class="toggle" aria-label="Tema"></button>
        <button class="menu-toggle" id="menuToggle" aria-label="Apri/chiudi menu"><span></span></button>
      </div>
    </nav>
  </div>
</header>

<!-- Menu full -->
<div class="sheet" id="siteMenu" role="dialog" aria-hidden="true" aria-modal="true" aria-label="menu sito">
  <div class="sheet__panel">
    <button class="sheet__close" id="sheetClose" type="button" aria-label="Chiudi menu">√ó</button>
    <div class="sheet__inner">
      <ul class="sheet__list">
        <li><a href="#about">About</a></li>
        <li><a href="#menu">Menu</a></li>
        <li><a href="#music">Musica</a></li>
        <li><a href="#events">Eventi</a></li>
        <li><a href="#gallery">Gallery</a></li>
        <li><a href="#contact">Contatti</a></li>
      </ul>
      <a class="pill pill--accent sheet__cta" href="https://wa.me/393298252092?text=Ciao%2017%2F19%20Urban%20Bistrot%2C%20vorrei%20prenotare" target="_blank" rel="noopener">Prenota</a>
    </div>
  </div>
</div>

<!-- HERO -->
<section class="hero">
  <div class="container grid grid-2">
    <!-- Poster -->
    <div class="reveal">
      <div class="poster-frame">
        <div class="poster-inner">
          <div class="poster-head">
            <div class="venue" id="posterVenue"></div>
            <div class="series" id="posterSeries"></div>
            <div class="date" id="posterDate"></div>
            <div class="tagline" id="posterTagline"></div>
            <div class="curated" id="posterCurated"></div>
          </div>
          <div class="poster-canvas" id="posterCanvas" aria-label="Canvas nomi (easter egg)">
            <div class="toast" id="eggToast" role="status" aria-live="polite">
              <button class="x" id="eggExit" title="Esci dall‚Äôeaster-egg">√ó</button>
              <h4>üéõÔ∏è Easter egg attivo!</h4>
              <p>Hai sbloccato l‚Äôarea interattiva dei nomi.</p>
              <ul class="tips">
                <li><strong>Doppio tap</strong>: gravit√† per 8s</li>
                <li><strong>Tap a due dita</strong>: mescola lineup</li>
              </ul>
            </div>
            <svg class="poster-svg" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
              <defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" stroke="currentColor" stroke-width="0.4" opacity="0.35"/></pattern></defs>
              <rect x="0" y="0" width="100" height="100" fill="url(#grid)"></rect>
            </svg>
          </div>
          <div class="poster-logos" id="posterLogos" aria-hidden="true"></div>
        </div>
      </div>
      <span class="tag" style="margin-top:10px">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="margin-right:6px">
          <path d="M12 22s7-5.33 7-12a7 7 0 1 0-14 0c0 6.67 7 12 7 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
        </svg>
        Roma ‚Ä¢ Via di Santa Costanza 17/19
      </span>
    </div>

    <!-- Orari + About -->
    <div class="hero-right">
      <aside class="card reveal" aria-label="Orari e Servizio">
        <div class="block-title"><h3>Orari & Apertura</h3><span class="meta">Servizio</span></div>
        <div class="time-cards">
          <div class="time-card"><div class="l"><span class="i" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M17 8h1a4 4 0 0 1 0 8h-1"/><path d="M3 8h14v6a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><path d="M6 2v4M10 2v4M14 2v4"/></svg>
          </span><strong>Colazioni</strong></div><strong>08:00‚Äì12:00</strong></div>
          <div class="time-card"><div class="l"><span class="i" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M4 3v7a2 2 0 0 0 2 2v9"/><path d="M8 3v7a2 2 0 0 1-2 2"/><path d="M12 3v18"/><path d="M15.5 3.5c2 2 2 6.5 0 8.5L12 12"/></svg>
          </span><strong>Pranzo</strong></div><strong>12:00‚Äì15:00</strong></div>
          <div class="time-card"><div class="l"><span class="i" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 7a6 6 0 0 0-6 6h12a6 6 0 0 0-6-6Z"/><path d="M12 5v2"/><path d="M4 19h16"/></svg>
          </span><strong>Cena</strong></div><strong>19:00‚Äì23:30</strong></div>
          <div class="time-card"><div class="l"><span class="i" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="2"/><path d="M14 10h.01"/><path d="M10 14h.01"/></svg>
          </span><strong>DJ Set</strong></div><strong>22:00‚Äì02:00</strong></div>
        </div>
      </aside>

      <div id="about" class="card reveal">
        <div class="block-title"><h3>Urban Bistrot</h3></div>
        <p style="margin:0">
          Specialty coffee, cucina contemporanea e serate <strong>vinyl only</strong>. Line-up a cura di <strong>Riccardo Battaglia</strong>.
        </p>
      </div>
    </div>
  </div>
</section>

<!-- Events -->
<section id="events">
  <div class="container">
    <div class="block-title" style="margin-bottom:12px"><h3>Prossimi Eventi</h3></div>
    <div class="grid" id="eventsList" style="gap:12px"></div>
    <div style="display:flex;justify-content:center;margin-top:8px">
      <button id="eventsMoreBtn" class="pill" type="button">Mostra altri</button>
    </div>
  </div>
</section>

<!-- Gallery -->
<section id="gallery">
  <div class="container">
    <div class="grid gallery" id="galleryGrid"></div>
    <p class="meta" style="margin-top:8px;text-align:center">Immagini da fonti pubbliche, citate con link all‚Äôoriginale.</p>
  </div>
</section>

<!-- Contact + Map -->
<section id="contact">
  <div class="container grid grid-2">
    <div class="card reveal">
      <div class="block-title"><h3>Contatti</h3></div>
      <p><strong>Indirizzo</strong><br/>Via di Santa Costanza 17/19 ‚Äî 00198 Roma</p>
      <p><strong>Prenotazioni</strong><br/>
        WhatsApp: <a class="pill" href="https://wa.me/393298252092" target="_blank" rel="noopener">+39 329 825 2092</a><br/>
        Email: <a class="pill" href="mailto:info@1719bistrot.it">info@1719bistrot.it</a>
      </p>
      <p><strong>Social</strong><br/>
        <a class="pill" href="https://instagram.com/1719_cocktailbar" target="_blank" rel="noopener">Instagram</a>
        <a class="pill" href="https://www.facebook.com/p/1719-Cocktail-Bar-Bistrot-100077668764198/" target="_blank" rel="noopener">Facebook</a>
      </p>
    </div>

    <div class="card reveal">
      <div class="block-title">
        <h3>Dove siamo</h3>
        <a class="pill pill--accent" href="https://maps.app.goo.gl/DH48FCh9wvF6mF8p6" target="_blank" rel="noopener">Apri su Google Maps</a>
      </div>
      <div class="poster-frame" style="border:none;padding:0">
        <iframe title="Mappa 17/19 Urban Bistrot" loading="lazy" referrerpolicy="no-referrer-when-downgrade" style="width:100%;height:340px;border:1px solid var(--line);border-radius:16px"
          src="https://www.google.com/maps?q=41.9226318,12.5118941&z=16&output=embed"></iframe>
      </div>
    </div>
  </div>
</section>

<footer>
  <div class="container">
    <p>&copy; 2025 17/19 Urban Bistrot Roma</p>
  </div>
</footer>

<script>
/* ========== Utilities ==========
   Compatte e pensate per mobile-first
*/
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

/* Scroll reveal */
const io = new IntersectionObserver((entries)=>{
  entries.forEach(e => { if(e.isIntersecting){ e.target.classList.add('active'); io.unobserve(e.target);} });
},{ threshold:.14 });
$$('.reveal').forEach(el=>io.observe(el));

/* Header translucido */
const header = document.querySelector('header');
const onS = ()=> header.classList.toggle('header--solid', scrollY>8);
addEventListener('scroll', onS, {passive:true}); onS();

/* Sheet menu */
(()=> {
  const siteMenu = $('#siteMenu');
  const inner = siteMenu.querySelector('.sheet__inner');
  const open = ()=>{ siteMenu.classList.add('active'); siteMenu.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; };
  const close= ()=>{ siteMenu.classList.remove('active'); siteMenu.setAttribute('aria-hidden','true'); document.body.style.overflow=''; };
  [$('#menuToggle'),$('#menuToggleD')].filter(Boolean).forEach(b=> b.addEventListener('click', ()=> siteMenu.classList.contains('active')?close():open()));
  $('#sheetClose').addEventListener('click', (e)=>{ e.stopPropagation(); close(); });
  siteMenu.addEventListener('click', (e)=>{ if(!inner.contains(e.target)) close(); });
  inner.addEventListener('click', (e)=> e.stopPropagation());
  addEventListener('keydown', (e)=>{ if(e.key==='Escape') close(); });
  siteMenu.querySelectorAll('a').forEach(a=> a.addEventListener('click', ()=> setTimeout(close,80)));
})();

/* Theme toggle */
(()=> {
  const THEME_KEY='theme-1719', root=document.documentElement;
  const paint = (mode)=>{
    const svgAuto = `<svg viewBox="0 0 24 24" width="18" height="18"><circle cx="12" cy="12" r="5" fill="currentColor" opacity=".9"/></svg>`;
    const svgSun  = `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2m0 16v2M2 12h2m16 0h2M4.9 4.9l1.4 1.4M17.7 17.7l1.4 1.4M4.9 19.1l1.4-1.4M17.7 6.3l1.4-1.4"/></svg>`;
    const svgMoon = `<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;
    const icon = mode==='auto'?svgAuto:mode==='light'?svgSun:svgMoon;
    $$('#themeToggle,#themeToggleM').forEach(b=> b.innerHTML=icon);
  };
  const apply = (m)=>{ root.setAttribute('data-theme', m); localStorage.setItem(THEME_KEY,m); paint(m); };
  const cycle = ()=>{ const cur=root.getAttribute('data-theme')||'auto'; apply(cur==='auto'?'light':cur==='light'?'dark':'auto'); };
  $$('#themeToggle,#themeToggleM').forEach(b=> b.addEventListener('click', cycle));
  apply(localStorage.getItem(THEME_KEY)||'auto');
})();

/* ===================== DATA DEMO ===================== */
const events = [
  { dateISO:'2025-09-03', comingSoon:false, venue:'17/19 URBAN BISTROT', title:'Electro Techno ‚Ä¢ Vinyl Only', genres:['TECHNO','ELECTRO','VINYL'], start:'22:30', curatedBy:'Riccardo Battaglia', headliner:'HEADLINER', guests:['GUEST1','GUEST2'], sponsors:[{text:'SPONSOR1'},{text:'SPONSOR2'}] },
  { dateISO:'2025-09-05', comingSoon:false, venue:'17/19 URBAN BISTROT', title:'Acid District', genres:['ACID','TECHNO','VINYL'], start:'22:30', curatedBy:'Riccardo Battaglia', headliner:'ALBA NERA', guests:['RBN','GIO BERLIN'], sponsors:[{text:'CASAMIGOS'}] },
  { dateISO:'2025-09-07', comingSoon:false, venue:'17/19 URBAN BISTROT', title:'Minimal Sunday', genres:['MINIMAL','DEEP','VINYL'], start:'18:00', curatedBy:'Riccardo Battaglia', headliner:'MARCO VOSS', guests:['LIVIA FERRO'], sponsors:[{text:'ORGANICS'}] },
  { dateISO:'2025-09-12', comingSoon:true,  venue:'17/19 URBAN BISTROT', title:'Friday Deep Cuts', genres:['DEEP','MINIMAL','VINYL'], start:'22:30', curatedBy:'Riccardo Battaglia', headliner:'TBA', guests:[] },
  { dateISO:'2025-09-14', comingSoon:true,  venue:'17/19 URBAN BISTROT', title:'Sunday Grooves', genres:['HOUSE','MINIMAL'], start:'18:00', curatedBy:'Riccardo Battaglia', headliner:'TBA' },
  { dateISO:'2025-09-20', comingSoon:true,  venue:'17/19 URBAN BISTROT', title:'Electro Romance', genres:['ELECTRO','TECHNO'], start:'22:30', curatedBy:'Riccardo Battaglia', headliner:'VALE C.', guests:['M.A.D.'] },
  { dateISO:'2025-09-27', comingSoon:true,  venue:'17/19 URBAN BISTROT', title:'Vinyl Marathon', genres:['TECHNO','HOUSE'], start:'22:00', curatedBy:'Riccardo Battaglia', headliner:'TBA' },
];

function toMonShort(d){ return d.toLocaleString('it-IT',{month:'short'}).toUpperCase(); }
function toItDowShort(d){ return d.toLocaleString('it-IT',{weekday:'short'}).toUpperCase(); }
function formatPosterDate(iso){
  const d = new Date(iso + 'T12:00:00Z');
  const days = ['SUNDAY','MONDAY','TUESDAY','WEDNESDAY','THURSDAY','FRIDAY','SATURDAY'];
  const dd = String(d.getUTCDate()).padStart(2,'0');
  const mm = String(d.getUTCMonth()+1).padStart(2,'0');
  return `${days[d.getUTCDay()]} ${dd}/${mm}`;
}
function formatLongIt(iso){
  const d = new Date(iso + 'T12:00:00');
  return d.toLocaleDateString('it-IT', { weekday:'short', day:'numeric', month:'long', year:'numeric' });
}
function buildWaText(ev){
  const when = formatLongIt(ev.dateISO);
  const start = ev.start ? ` (start ${ev.start})` : '';
  return `Ciao 17/19 Urban Bistrot, vorrei prenotare un tavolo per "${ev.title}" di ${when}${start}. Nome: ____ ‚Ä¢ Persone: ____`;
}
function waUrlFromEvent(ev){ return `https://wa.me/393298252092?text=${encodeURIComponent(buildWaText(ev))}`; }
function pickNextEvent(){
  const today = new Date(); today.setHours(0,0,0,0);
  const up = events.filter(e=>!isNaN(new Date(e.dateISO)) && new Date(e.dateISO) >= today)
                   .sort((a,b)=> new Date(a.dateISO)-new Date(b.dateISO));
  return up[0] || events.sort((a,b)=> new Date(a.dateISO)-new Date(b.dateISO))[0];
}

/* Render poster texts */
function setPosterTexts(ev){
  const set = (id,txt)=>{ const el=$(id); };
}
(function(){
  const ev = pickNextEvent();
  $('#posterVenue').textContent = (ev.venue||'17/19 URBAN BISTROT').toUpperCase();
  $('#posterSeries').textContent = (ev.title||'').toUpperCase();
  $('#posterDate').textContent = formatPosterDate(ev.dateISO);
  $('#posterTagline').textContent = (ev.genres && ev.genres.length ? ev.genres.join(' ‚Ä¢ ') : 'TECHNO ‚Ä¢ ELECTRO ‚Ä¢ VINYL').toUpperCase();
  $('#posterCurated').textContent = ('Curated by ' + (ev.curatedBy || 'Riccardo Battaglia')).toUpperCase();
  const logosWrap = $('#posterLogos'); logosWrap.innerHTML='';
  (ev.sponsors||[]).forEach(L=>{
    if(L.src){ const img=new Image(); img.src=L.src; img.alt=L.alt||'logo'; img.style.maxHeight='14px'; img.style.opacity='.9'; logosWrap.appendChild(img); }
    else if(L.text){ const s=document.createElement('span'); s.textContent=(L.text||'').toUpperCase(); s.style.fontWeight='900'; s.style.fontSize='.72rem'; s.style.letterSpacing='.12em'; logosWrap.appendChild(s); }
  });
})();

/* ========== EVENTS RENDER ========= */
let eventsExpanded=false;
function renderEvents(){
  const list = $('#eventsList');
  const sorted = [...events].sort((a,b)=> new Date(a.dateISO)-new Date(b.dateISO)).slice(0,7);
  const toShow = eventsExpanded ? sorted : sorted.slice(0,3);
  list.innerHTML='';
  toShow.forEach(ev=>{
    const d = new Date(ev.dateISO + 'T12:00:00');
    const day = String(d.getUTCDate()).padStart(2,'0');
    const mon = toMonShort(d);
    const dow = toItDowShort(d).slice(0,3).toUpperCase();

    const el = document.createElement('div'); el.className='event';
    el.innerHTML = `
      <div class="event__title"><strong>${ev.title}</strong></div>
      <div class="event__top">
        <div class="event__date"><div class="event__dow">${dow}</div><div class="event__day">${day} ${mon}</div></div>
        ${ev.comingSoon ? `<span class="pill pill--accent" style="opacity:.7">Coming Soon</span>` : `<a class="pill" href="${waUrlFromEvent(ev)}" target="_blank" rel="noopener">Prenota</a>`}
      </div>
      <div class="event__info">${ev.comingSoon ? `COMING SOON` : `${ev.start?`<span>Start ${ev.start}</span>`:''} ${(ev.genres||[]).map(g=>`<span>${g}</span>`).join(' ')} ${(ev.guests&&ev.guests.length)?`<span>Guests: ${ev.guests.join(', ')}</span>`:''}`}</div>
    `;
    list.appendChild(el);
  });
  const btn = $('#eventsMoreBtn');
  if(sorted.length <= 3){ btn.style.display = 'none'; }
  else { btn.style.display = 'inline-flex'; btn.textContent = eventsExpanded ? 'Mostra meno' : 'Mostra altri'; }
}
renderEvents();
$('#eventsMoreBtn').addEventListener('click', ()=>{ eventsExpanded=!eventsExpanded; renderEvents(); });

/* Gallery demo */
const galleryData = [
  { src:'https://img3.restaurantguru.com/c493-Pub-and-bar-17-19-interior.jpg', alt:'Interni 17/19', credit:'Restaurant Guru', href:'https://restaurantguru.it/1719-LIve-Eat-Drink-Love-Rome' },
  { src:'https://img.restaurantguru.com/ccd7-17-19-Stenfields-and-c-Rome-dishes.jpg', alt:'Piatti 17/19', credit:'Restaurant Guru', href:'https://restaurantguru.it/1719-LIve-Eat-Drink-Love-Rome' },
  { src:'https://img3.restaurantguru.com/c467-Pub-and-bar-17-19-Stenfields-and-c-exterior.jpg', alt:'Esterni 17/19', credit:'Restaurant Guru', href:'https://restaurantguru.it/1719-LIve-Eat-Drink-Love-Rome' },
  { src:'https://iorampo.com/wp-content/uploads/2024/12/17-19-800x600.jpg', alt:'Bar 17/19', credit:'IoRampo', href:'https://iorampo.com' }
];
const galleryGrid = $('#galleryGrid');
galleryData.forEach(g=>{
  const a=document.createElement('a'); a.href=g.href; a.target='_blank'; a.rel='noopener';
  a.innerHTML = `<img loading="lazy" decoding="async" src="${g.src}" alt="${g.alt}"><span class="credit">¬© ${g.credit}</span>`;
  galleryGrid.appendChild(a);
});

/* ===================== POSTER EASTER EGG ===================== */
const posterCanvas = $('#posterCanvas');
const eggToast = $('#eggToast');
const eggExit  = $('#eggExit');

let bounceRAF = null, bouncers = [];
let easterEggEnabled = false;   // disabilitato finch√© non fai triplo tap
let gravityUntil = 0;           // timestamp ms fino a cui la gravit√† √® attiva
const GRAVITY = 900;            // px/s^2
const TRAIL_SPEED = 520;        // px/s per scie

function clearBouncers(){ cancelAnimationFrame(bounceRAF); bouncers.forEach(b=> b.el.remove()); bouncers = []; }

function spawnBouncersFromEvent(ev){
  const names = [ev.headliner].concat(ev.guests||[]).filter(Boolean).map(s=>s.toUpperCase()).slice(0,3);
  initBouncers(names);
}

function initBouncers(names){
  clearBouncers();
  const rect = posterCanvas.getBoundingClientRect();

  names.forEach((name, idx)=>{
    const el = document.createElement('div');
    el.className = 'bouncer';
    el.setAttribute('role','button');
    el.setAttribute('aria-label', `DJ ${name}`);
    el.innerHTML = `<span class="dot"></span>${name}`;
    posterCanvas.appendChild(el);

    const w = el.offsetWidth  || 84;
    const h = el.offsetHeight || 30;
    const x = Math.random() * Math.max(1, rect.width  - w);
    const y = Math.random() * Math.max(1, rect.height - h);

    const speed = 90 + (idx*14) + Math.random()*40;
    const angle = Math.random() * Math.PI * 2;
    const vx = Math.cos(angle) * speed;
    const vy = Math.sin(angle) * speed;

    const b = { el, x, y, w, h, vx, vy, dragging:false, trace:[], asleepFor:0, lastTrail:0 };
    bouncers.push(b);
    enableBouncerInteractions(b);
  });

  startPhysicsLoop();
}

function startPhysicsLoop(){
  let acc = 0, last = performance.now();
  const STEP = 1/120;
  const MAX_FRAME = 1/20;
  const FRICTION = 0.9993;
  const BOUNCE_K = 0.82; // rimbalzo elastico sul fondo con gravit√†

  const tick = (now)=>{
    let dt = Math.min(MAX_FRAME, (now - last) / 1000);
    last = now; acc += dt;

    const W = posterCanvas.clientWidth, H = posterCanvas.clientHeight;
    const gActive = (performance.now() < gravityUntil);

    while(acc >= STEP){
      for(const b of bouncers){
        if(b.dragging) continue;

        // gravit√† opzionale
        if(gActive){ b.vy += GRAVITY * STEP; }

        b.x += b.vx * STEP;
        b.y += b.vy * STEP;

        // muri
        if(b.x <= 0){ b.x = 0; b.vx *= -1; }
        if(b.y <= 0){ b.y = 0; b.vy *= -1; }
        if(b.x + b.w >= W){ b.x = W - b.w; b.vx *= -1; }
        if(b.y + b.h >= H){
          b.y = H - b.h;
          b.vy *= -1;
          if(gActive) b.vy *= BOUNCE_K; // smorzo leggero quando c'√® gravit√†
        }

        // attrito
        b.vx *= FRICTION;
        b.vy *= FRICTION;
      }

      // collisioni
      for(let i=0;i<bouncers.length;i++){
        const a = bouncers[i]; if(a.dragging) continue;
        for(let j=i+1;j<bouncers.length;j++){
          const c = bouncers[j]; if(c.dragging) continue;
          if(a.x < c.x + c.w && a.x + a.w > c.x && a.y < c.y + c.h && a.y + a.h > c.y){
            const overlapX = Math.min(a.x+a.w, c.x+c.w) - Math.max(a.x, c.x);
            const overlapY = Math.min(a.y+a.h, c.y+c.h) - Math.max(a.y, c.y);
            if(overlapX < overlapY){
              const dir = (a.x + a.w/2) < (c.x + c.w/2) ? -1 : 1;
              a.x += dir*overlapX/2; c.x -= dir*overlapX/2;
              const tmp = a.vx; a.vx = c.vx; c.vx = tmp;
            }else{
              const dir = (a.y + a.h/2) < (c.y + c.h/2) ? -1 : 1;
              a.y += dir*overlapY/2; c.y -= dir*overlapY/2;
              const tmp = a.vy; a.vy = c.vy; c.vy = tmp;
            }
          }
        }
      }

      acc -= STEP;
    }

    // paint + scie
    for(const b of bouncers){
      b.el.style.transform = `translate3d(${b.x}px, ${b.y}px, 0)`;
      const speed = Math.hypot(b.vx, b.vy);
      if(speed > TRAIL_SPEED && now - b.lastTrail > 120){
        try{
          b.el.animate(
            [{filter:'blur(0px)', opacity:1},
             {filter:'blur(3px)', opacity:.6, offset:.6},
             {filter:'blur(0px)', opacity:1}],
            {duration:180, easing:'ease-out'}
          );
        }catch{} // fallback silenzioso se WA non disponibile
        b.lastTrail = now;
      }
    }

    bounceRAF = requestAnimationFrame(tick);
  };

  cancelAnimationFrame(bounceRAF);
  bounceRAF = requestAnimationFrame(tick);

  // risparmio batteria
  document.addEventListener('visibilitychange', ()=>{
    if(document.hidden){ cancelAnimationFrame(bounceRAF); }
    else { last = performance.now(); bounceRAF = requestAnimationFrame(tick); }
  }, {passive:true});

  // clamp su resize/orientation
  const clampAll = ()=>{
    const W = posterCanvas.clientWidth, H = posterCanvas.clientHeight;
    for(const b of bouncers){
      b.x = Math.max(0, Math.min(W - b.w, b.x));
      b.y = Math.max(0, Math.min(H - b.h, b.y));
      b.el.style.transform = `translate3d(${b.x}px, ${b.y}px, 0)`;
    }
  };
  addEventListener('resize', clampAll, {passive:true});
  addEventListener('orientationchange', clampAll, {passive:true});
}

/* Drag & throw (pointer + RAF) */
function enableBouncerInteractions(b){
  const getRect = ()=> posterCanvas.getBoundingClientRect();
  let draggingFrame = null, wantDrag=false, px=0, py=0;

  const start = (e)=>{
    if(!easterEggEnabled) return; // disabilitato
    e.preventDefault();
    wantDrag = true;
    b.dragging = true;
    b.el.classList.add('bouncer--dragging');
    posterCanvas.appendChild(b.el); // porta sopra
    b.vx = 0; b.vy = 0; b.trace = [];
    try{ b.el.setPointerCapture(e.pointerId); }catch{}

    const r = getRect();
    px = (e.clientX - r.left);
    py = (e.clientY - r.top);
    b.offsetX = px - b.x;
    b.offsetY = py - b.y;

    if(!draggingFrame){
      const tick = ()=>{
        if(!wantDrag){ draggingFrame = null; return; }
        const W = posterCanvas.clientWidth, H = posterCanvas.clientHeight;
        const nx = Math.max(0, Math.min(W - b.w, px - b.offsetX));
        const ny = Math.max(0, Math.min(H - b.h, py - b.offsetY));
        b.x = nx; b.y = ny;
        b.el.style.transform = `translate3d(${b.x}px, ${b.y}px, 0)`;
        const t = performance.now();
        b.trace.push({x:b.x,y:b.y,t}); if(b.trace.length>6) b.trace.shift();
        draggingFrame = requestAnimationFrame(tick);
      };
      draggingFrame = requestAnimationFrame(tick);
    }
  };

  const move = (e)=>{
    if(!b.dragging) return;
    const r = getRect();
    px = (e.clientX - r.left);
    py = (e.clientY - r.top);
    e.preventDefault();
  };

  const end = (e)=>{
    if(!b.dragging) return;
    try{ b.el.releasePointerCapture(e.pointerId); }catch{}
    b.el.classList.remove('bouncer--dragging');
    wantDrag = false; b.dragging = false;

    if(b.trace.length >= 2){
      const a = b.trace[Math.max(0, b.trace.length-4)];
      const z = b.trace[b.trace.length-1];
      const dt = Math.max(0.016, (z.t - a.t)/1000);
      let vx = (z.x - a.x)/dt, vy = (z.y - a.y)/dt;
      const speed = Math.hypot(vx,vy), min=160, max=720;
      if(speed < min){ const ang = Math.atan2(vy,vx) || Math.random()*Math.PI*2; vx=Math.cos(ang)*min; vy=Math.sin(ang)*min; }
      else if(speed > max){ vx *= max/speed; vy *= max/speed; }
      b.vx = vx; b.vy = vy;
    }
  };

  b.el.addEventListener('pointerdown', start, {passive:false});
  b.el.addEventListener('pointermove', move,   {passive:false});
  b.el.addEventListener('pointerup',   end,    {passive:false});
  b.el.addEventListener('pointercancel', end,  {passive:false});
}

/* ===== Gestures su canvas =====
   - Triplo tap: abilita/disabilita easter egg + toast
   - Doppio tap: gravit√† per 8s
   - Tap a due dita: shuffle lineup
*/
(function setupCanvasGestures(){
  const TAP_TIME = 300;   // ms per doppio tap
  const TRIPLE_WINDOW = 600;
  const MOVE_TOL = 12;    // px

  let lastTapTime = 0;
  let tapCount = 0;
  let lastPos = {x:0,y:0};

  // multi-touch detection
  const active = new Map(); // pointerId -> {x,y,t}
  let multiTapTimer = null;

  posterCanvas.addEventListener('pointerdown', (e)=>{
    // registra
    active.set(e.pointerId, {x:e.clientX, y:e.clientY, t:performance.now()});
  }, {passive:true});

  posterCanvas.addEventListener('pointerup', (e)=>{
    const now = performance.now();
    const start = active.get(e.pointerId);
    active.delete(e.pointerId);

    // due dita tap: se entro 250ms e poco movimento e non c'√® drag
    if(active.size===0 && start){
      const dt = now - start.t;
      const moved = Math.hypot(e.clientX-start.x, e.clientY-start.y);
      if(dt < 250 && moved < MOVE_TOL){
        // controlla se c'√® stato un altro pointerup quasi simultaneo
        if(multiTapTimer){ // secondo dito
          clearTimeout(multiTapTimer); multiTapTimer = null;
          shuffleLineup(); // azione
          return;
        }else{
          // aspetta breve finestra per vedere se arriva il secondo dito
          multiTapTimer = setTimeout(()=>{ multiTapTimer=null; }, 220);
        }
      }
    }

    // single-finger taps (double / triple)
    const moved = Math.hypot(e.clientX-lastPos.x, e.clientY-lastPos.y);
    if(moved < MOVE_TOL){
      if(now - lastTapTime < TAP_TIME){
        tapCount++;
      }else{
        tapCount = 1;
      }
      lastTapTime = now;
      lastPos = {x:e.clientX, y:e.clientY};

      if(tapCount===2){
        activateGravity();
      }
      if(tapCount===3){
        tapCount=0;
        toggleEasterEgg(); // mostra toast e abilita/disabilita
      }

      // reset finestra triplo
      setTimeout(()=>{ tapCount=0; }, TRIPLE_WINDOW);
    }else{
      tapCount=0;
    }
  }, {passive:true});

  // Previeni gesture del browser SOLO sulla canvas (non altrove)
  posterCanvas.addEventListener('gesturestart', e=> e.preventDefault());
  posterCanvas.addEventListener('gesturechange', e=> e.preventDefault());
  posterCanvas.addEventListener('gestureend', e=> e.preventDefault());
})();

function activateGravity(){
  gravityUntil = performance.now() + 8000; // 8s
  // piccolo feedback (pulse del bordo canvas)
  posterCanvas.animate([{boxShadow:'0 0 0 0 rgba(255,255,255,0)'},
                        {boxShadow:'0 0 0 4px rgba(255,255,255,.08)'},
                        {boxShadow:'0 0 0 0 rgba(255,255,255,0)'}],
                       {duration:420, easing:'ease-out'});
}

function shuffleLineup(){
  if(!easterEggEnabled) return;
  const names = bouncers.map(b => b.el.textContent.trim());
  names.sort(()=> Math.random() - .5);
  initBouncers(names); // respawn
  // feedback
  posterCanvas.animate([{transform:'scale(1)'},{transform:'scale(1.02)'},{transform:'scale(1)'}],{duration:200});
}

function toggleEasterEgg(){
  easterEggEnabled = !easterEggEnabled;
  eggToast.classList.toggle('show', easterEggEnabled);
  if(!easterEggEnabled){
    // chi esce: nascondi toast, ma lascia screensaver attivo
    eggToast.classList.remove('show');
  }else{
    // entra: piccolo ding
    try{ new AudioContext(); }catch{}
  }
}

// X per uscire dall‚Äôeaster-egg
eggExit.addEventListener('click', ()=>{
  easterEggEnabled = false;
  eggToast.classList.remove('show');
});

/* ===== Avvio ===== */
spawnBouncersFromEvent(pickNextEvent());
easterEggEnabled = false; // di default spento, attivalo con triplo tap
</script>
</body>
</html>
