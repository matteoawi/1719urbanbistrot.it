<!DOCTYPE html>
<html lang="it" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>17/19 Urban Bistrot</title>
  <meta name="description" content="17/19 Urban Bistrot Roma. Colazioni, pranzi, cene e cocktail. Location per eventi privati." />
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#0b0b0b" media="(prefers-color-scheme: dark)">
  
  <div class="gtranslate_wrapper"></div>
<script>window.gtranslateSettings = {"default_language":"it","detect_browser_language":true,"languages":["it","en","fr","es","pt","ru","ar","uk","pl","nl","de"],"wrapper_selector":".gtranslate_wrapper"}</script>
<script src="https://cdn.gtranslate.net/widgets/latest/float.js" defer></script>
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%230b0b0b'/%3E%3Ctext x='50%25' y='54%25' dominant-baseline='middle' text-anchor='middle' font-family='Montserrat,Arial' font-size='28' fill='%23fff'%3E17%2F19%3C/text%3E%3C/svg%3E" />
  <link rel="icon" type="image/svg+xml" href="https://cdn.shopify.com/s/files/1/0887/8332/3459/files/1719logobianco.svg?v=1755104086">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet"/>

  <style>
    /* ===== VARIABLES & BASE STYLES ===== */
    .notranslate { unicode-bidi: isolate; }

    :root {
      --menu-blur: 18px; --menu-dim: 0.68;
      --bg: #ffffff; --fg: #0b0b0b; --muted: #6b7280; --line: #e5e7eb;
      --accent: #c23331; --accent-fg: #ffffff;
      --chip: #f4f4f5; --chip-fg: #0b0b0b;
      --radius: 16px; --pad: clamp(16px, 4vw, 32px); --max: 1120px;
      --header-h: 64px;
    }

    @media (prefers-color-scheme: dark) {
      html[data-theme="auto"] {
        --bg: #0b0b0b; --fg: #ffffff; --muted: #9ca3af; --line: #1f1f1f;
        --chip: #121212; --chip-fg: #e5e7eb;
      }
    }

    html[data-theme="light"] {
      --bg: #ffffff; --fg: #0b0b0b; --muted: #6b7280; --line: #e5e7eb;
      --chip: #f4f4f5; --chip-fg: #0b0b0b;
    }

    html[data-theme="dark"] {
      --bg: #0b0b0b; --fg: #ffffff; --muted: #9ca3af; --line: #1f1f1f;
      --chip: #121212; --chip-fg: #e5e7eb;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { margin: 0; max-width: 100%; overflow-x: hidden; scrollbar-gutter: stable both-edges; }
    body { background: var(--bg); color: var(--fg); font-family: 'Inter', system-ui, sans-serif; line-height: 1.6; }
    img { max-width: 100%; display: block; }
    .container { max-width: var(--max); margin-inline: auto; padding-inline: var(--pad); }
    section { padding: 20px 0; }
    .grid { display: grid; gap: 16px; }
    .grid-2 { grid-template-columns: 1fr; }
    .grid-3 { grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
    .only-desktop { display: none; }
    .only-mobile { display: inline-flex; }

    @media (min-width: 768px) {
      .grid-2 { grid-template-columns: 1.2fr .8fr; }
      .only-desktop { display: inline-flex; }
      .only-mobile { display: none; }
    }

    /* ===== HEADER & NAVIGATION ===== */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: transparent;
      border-bottom: 0;
      z-index: 100;
      transition: all 0.3s ease;
    }

    header.header--solid {
      background: color-mix(in oklab, var(--bg) 85%, transparent);
      border-bottom: 1px solid var(--line);
      backdrop-filter: saturate(140%) blur(8px);
    }

    nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: var(--header-h);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: inherit;
    }

    .brand img {
      height: 48px;
      width: auto;
    }

    @media (min-width: 768px) {
      .brand img { height: 56px; }
    }

    .logo-dark { display: none; }
    .logo-light { display: inline; }

    html[data-theme="dark"] .logo-light { display: none; }
    html[data-theme="dark"] .logo-dark { display: inline; }
    html[data-theme="light"] .logo-light { display: inline; }
    html[data-theme="light"] .logo-dark { display: none; }

    @media (prefers-color-scheme: dark) {
      html[data-theme="auto"] .logo-light { display: none; }
      html[data-theme="auto"] .logo-dark { display: inline; }
    }

    @media (prefers-color-scheme: light) {
      html[data-theme="auto"] .logo-light { display: inline; }
      html[data-theme="auto"] .logo-dark { display: none; }
    }

    .nav-desktop {
      display: none;
      gap: 12px;
      align-items: center;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .nav-desktop a {
      color: var(--fg);
      text-decoration: none;
      font-weight: 700;
      opacity: .86;
      transition: opacity 0.2s ease;
    }

    .nav-desktop a:hover { opacity: 1; }

    @media (min-width: 768px) {
      .nav-desktop { display: flex; }
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: .55rem;
      padding: .55rem .9rem;
      border: 1px solid var(--line);
      border-radius: 999px;
      text-decoration: none;
      font-weight: 800;
      background: var(--chip);
      color: var(--chip-fg);
      transition: transform 0.15s ease;
    }

    .pill--accent {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--accent-fg);
    }

    .pill--ghost { background: transparent; }
    .pill--disabled { opacity: .55; pointer-events: none; }
    .pill--wide { padding: .66rem 1rem; font-weight: 900; }

    .pill:where(:hover, :focus-visible) { transform: translateY(-1px); }

    .toggle {
      width: 40px;
      height: 40px;
      border: 1px solid var(--line);
      border-radius: 12px;
      background: var(--chip);
      color: var(--chip-fg);
      display: grid;
      place-items: center;
      cursor: pointer;
    }

    .menu-toggle {
      width: 44px;
      height: 44px;
      border: 1px solid var(--line);
      border-radius: 12px;
      background: var(--chip);
      display: grid;
      place-items: center;
      cursor: pointer;
    }

    .menu-toggle span,
    .menu-toggle span::before,
    .menu-toggle span::after {
      display: block;
      width: 18px;
      height: 2px;
      background: var(--fg);
      content: "";
      position: relative;
    }

    .menu-toggle span::before { position: absolute; top: -6px; }
    .menu-toggle span::after { position: absolute; top: 6px; }

    /* ===== FULLSCREEN MENU ===== */
    .sheet {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .68);
      opacity: 0;
      pointer-events: none;
      z-index: 999;
      transition: opacity .25s ease;
      backdrop-filter: blur(18px) saturate(120%);
      color: #fff;
    }

    .sheet.active {
      opacity: 1;
      pointer-events: auto;
    }

    .sheet__panel {
      position: absolute;
      inset: 0;
      display: grid;
      grid-template-rows: auto 1fr;
      align-items: start;
    }

    .sheet__close {
      position: absolute;
      top: 14px;
      right: 14px;
      width: 44px;
      height: 44px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, .25);
      background: rgba(255, 255, 255, .10);
      color: #fff;
      font-size: 24px;
      font-weight: 900;
      display: grid;
      place-items: center;
      cursor: pointer;
      z-index: 1000;
      touch-action: manipulation;
    }

    .sheet__inner {
      display: grid;
      place-items: center;
      height: 100%;
      padding: 28px;
      opacity: 0;
      transform: translateY(6px) scale(.99);
      overflow: auto;
    }

    .sheet__list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: 14px;
      text-align: center;
    }

    .sheet__list a {
      display: block;
      padding: 10px 14px;
      border-radius: 14px;
      text-decoration: none;
      color: #fff;
      font-weight: 900;
      font-size: clamp(1.4rem, 5vw, 2.4rem);
      letter-spacing: .04em;
      transition: background 0.2s ease;
    }

    .sheet__list a:hover { background: rgba(255, 255, 255, .08); }

    .sheet__cta {
      display: inline-flex;
      margin-top: 18px;
    }

    .sheet.active .sheet__inner {
      opacity: 1;
      transform: none;
      transition: opacity .25s ease .06s, transform .25s ease .06s;
    }

    .sheet.active .sheet__list a {
      animation: menuStagger .28s ease both;
    }

    .sheet.active .sheet__list li:nth-child(1) a { animation-delay: .05s; }
    .sheet.active .sheet__list li:nth-child(2) a { animation-delay: .09s; }
    .sheet.active .sheet__list li:nth-child(3) a { animation-delay: .13s; }
    .sheet.active .sheet__list li:nth-child(4) a { animation-delay: .17s; }
    .sheet.active .sheet__list li:nth-child(5) a { animation-delay: .21s; }
    .sheet.active .sheet__list li:nth-child(6) a { animation-delay: .25s; }

    @keyframes menuStagger {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    body.menu-open { overflow: hidden; }
    body.menu-open > :not(.sheet) { filter: blur(10px) saturate(1.06); transition: filter .25s ease; transform: translateZ(0); }

    /* ===== HERO SECTION ===== */
    .hero { padding: calc(var(--header-h) + 8px) 0 24px; }

    .tag {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 10px;
      font-weight: 800;
      color: var(--chip-fg);
      max-width: 100%;
      white-space: normal;
      flex-wrap: wrap;
      overflow-wrap: anywhere;
    }

    h1 {
      font-family: 'Montserrat', system-ui, sans-serif;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: .01em;
      font-size: clamp(2.1rem, 8vw, 3.6rem);
      line-height: 1.1;
      margin: 12px 0 10px;
    }

    .lead {
      color: var(--fg);
      font-size: clamp(1rem, 4.5vw, 1.18rem);
      margin: 8px 0 14px;
    }

    .hero-media {
      position: relative;
      border: 1px solid var(--line);
      border-radius: 16px;
      overflow: hidden;
      aspect-ratio: 4/5;
      background: var(--chip);
      margin-top: 14px;
      contain: paint;
      backface-visibility: hidden;
    }

    @media (min-width: 768px) {
      .hero-media { aspect-ratio: 16/9; margin-top: 18px; }
    }

    @media (max-width: 430px) {
      .hero-media { aspect-ratio: 3 / 4; }
    }

    @media (min-width: 431px) and (max-width: 480px) {
      .hero-media { aspect-ratio: 4 / 5; }
    }

    .slide {
      position: absolute;
      inset: 0;
      opacity: 0;
      transition: opacity .35s;
    }

    .slide.active { opacity: 1; }

    .dots {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 8px;
      display: flex;
      gap: 6px;
      justify-content: center;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #a1a1aa;
      border: 1px solid #00000020;
      cursor: pointer;
      opacity: .85;
    }

    .dot.active { background: #fff; opacity: 1; }

    /* ===== CARDS ===== */
    .card {
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 16px;
      background: color-mix(in oklab, var(--bg) 96%, transparent);
    }

    .block-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .block-title h3 {
      font-family: 'Montserrat', system-ui, sans-serif;
      font-size: 1rem;
      margin: 0;
      letter-spacing: .02em;
    }

    .meta { color: var(--muted); font-size: .95rem; }

    .hero-right { display: grid; gap: 12px; }

/* ===== TIME CARDS (auto 1↔2 colonne) ===== */
.time-cards {
  display: grid;
  /* passa a 2 colonne solo quando ogni card può avere almeno 260px */
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 12px;
  margin-top: 6px;
  /* evita overflow delle card in grid */
  align-items: stretch;
}
.time-cards > * { min-width: 0; }

/* Card */
.time-card {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  border: 1px solid var(--line);
  border-radius: 14px;
  padding: 10px 12px;
  background: color-mix(in oklab, var(--bg) 98%, transparent);
}

.time-card .l {
  display: flex;
  align-items: center;
  gap: 8px;
}

.time-card .i {
  display: grid;
  place-items: center;
  width: 28px;
  height: 28px;
  border-radius: 10px;
  background: var(--chip);
  border: 1px solid var(--line);
}

    /* ===== MENU ACCORDION ===== */
    .badge {
      display: inline-block;
      background: var(--accent);
      color: var(--accent-fg);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: .75rem;
      font-weight: 900;
    }

    details.menu-acc {
      border: 1px solid var(--line);
      border-radius: 16px;
      background: color-mix(in oklab, var(--bg) 96%, transparent);
      padding: 12px;
    }

    details.menu-acc + details.menu-acc { margin-top: 12px; }
    details.menu-acc[open] { background: color-mix(in oklab, var(--bg) 98%, transparent); }

    summary.menu-sum {
      list-style: none;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }

    summary.menu-sum::-webkit-details-marker { display: none; }

    .menu-sum h3 { margin: 8px 0 0; font-family: 'Montserrat', system-ui, sans-serif; }

    .menu-sum .chev {
      margin-left: auto;
      transition: transform .2s;
    }

    details[open] .menu-sum .chev { transform: rotate(180deg); }

    .menu-body { padding: 8px 4px 2px; }

    .group-title { margin: 8px 0 4px; font-weight: 800; }

    .menu-item {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px dashed var(--line);
    }

    .menu-item .mi-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }

    .menu-item:last-child { border-bottom: 0; }

    .price { color: var(--accent); font-weight: 800; }

    /* ===== EVENTS ===== */
    .event {
      position: relative;
      display: grid;
      gap: 10px;
      align-items: start;
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 14px;
      background: color-mix(in oklab, var(--bg) 96%, transparent);
      transition: box-shadow .2s, transform .2s, border-color .2s;
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
      will-change: transform;
    }

    .event__title { font-weight: 900; }

    .event__top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .event__date {
      min-width: 66px;
      text-align: center;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 8px 10px;
      background: var(--chip);
    }

    .event__dow { font-weight: 900; }
    .event__day { font-size: 1.4rem; font-weight: 900; line-height: 1; }

    .event__info {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      color: var(--muted);
      font-size: .95rem;
    }

    .event__names {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
      user-select: none;
      -webkit-user-select: none;
    }

    .event__sponsors {
      display: none;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 6px;
      user-select: none;
      -webkit-user-select: none;
    }

    .event--show-sponsors .event__sponsors { display: flex; }

    .events-more {
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }

    .event__actions { display: flex; gap: 8px; flex-wrap: wrap; }

    .event--voted {
      border-color: color-mix(in oklab, var(--accent) 65%, transparent);
      box-shadow: 0 0 0 1px color-mix(in oklab, var(--accent) 35%, transparent) inset, 0 6px 18px rgba(255, 31, 61, .22);
      animation: upPulse 1.2s ease-in-out infinite alternate;
    }

    @keyframes upPulse {
      from { box-shadow: 0 0 0 1px rgba(255, 31, 61, .26) inset, 0 4px 14px rgba(255, 31, 61, .18); }
      to { box-shadow: 0 0 0 1px rgba(255, 31, 61, .36) inset, 0 8px 22px rgba(255, 31, 61, .24); }
    }

    @keyframes cardPopShake {
      0% { transform: scale(1) translateX(0) rotate(0); }
      12% { transform: scale(1.03) translateX(-1.5px) rotate(-0.3deg); }
      24% { transform: scale(1.03) translateX(1.5px) rotate(0.3deg); }
      36% { transform: scale(1.02) translateX(-1px) rotate(-0.2deg); }
      48% { transform: scale(1.02) translateX(1px) rotate(0.2deg); }
      60% { transform: scale(1.01) translateX(0.5px) rotate(0); }
      100% { transform: scale(1) translateX(0) rotate(0); }
    }

    .event--burst { animation: cardPopShake .6s cubic-bezier(.2, .8, .2, 1); }

    .vote-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      font-weight: 900;
      background: color-mix(in oklab, var(--bg) 92%, transparent);
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 4px 8px;
      font-size: .9rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .icon { width: 16px; height: 16px; display: inline-block; vertical-align: middle; }

    .share-pop {
      position: absolute;
      z-index: 50;
      background: color-mix(in oklab, var(--bg) 96%, transparent);
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 8px;
      display: none;
      gap: 6px;
    }

    .share-pop button, .share-pop a {
      border: 1px solid var(--line);
      background: var(--chip);
      color: var(--chip-fg);
      border-radius: 8px;
      padding: 6px 8px;
      text-decoration: none;
      font-weight: 800;
      font-size: .9rem;
    }

    /* ===== NAME CHIPS ===== */
    .name-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: .18rem .46rem;
      border: 1px dashed var(--line);
      border-radius: 12px;
      font-weight: 800;
      letter-spacing: .04em;
      background: color-mix(in oklab, var(--bg) 98%, transparent);
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }

    /* ===== POSTER & BOUNCERS ===== */
    .poster-frame {
      position: relative;
      border: 1px solid var(--line);
      border-radius: 20px;
      background: var(--bg);
      overflow: hidden;
      margin-bottom: 12px;
      contain: layout paint;
      backface-visibility: hidden;
      transform: translateZ(0);
    }

    .poster-inner { position: relative; padding: clamp(18px, 4vw, 28px); }

    .poster-head {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 6px;
      user-select: none;
      -webkit-user-select: none;
    }

    .poster-head .venue {
      font-weight: 900;
      letter-spacing: .10em;
      text-transform: uppercase;
      font-size: clamp(.9rem, 1.8vw, 1rem);
    }

    .poster-head .series {
      font-family: 'Montserrat', system-ui, sans-serif;
      font-weight: 900;
      letter-spacing: .06em;
      text-transform: uppercase;
      font-size: clamp(2rem, 6.5vw, 3.1rem);
      line-height: 1.05;
    }

    .poster-head .date {
      font-weight: 900;
      letter-spacing: .10em;
      text-transform: uppercase;
      font-size: clamp(.95rem, 3.5vw, 1.2rem);
    }

    .poster-head .tagline {
      margin-top: 4px;
      font-weight: 900;
      letter-spacing: .10em;
      text-transform: uppercase;
      color: var(--fg);
      font-size: clamp(.82rem, 2.2vw, .96rem);
    }

    .poster-head .curated {
      color: var(--muted);
      font-weight: 700;
      letter-spacing: .08em;
      text-transform: uppercase;
      font-size: clamp(.78rem, 2vw, .9rem);
    }

    .poster-canvas {
      position: relative;
      margin-top: clamp(16px, 3.2vw, 26px);
      height: clamp(320px, 56vw, 480px);
      background: color-mix(in oklab, var(--chip) 94%, transparent);
      border: 1px solid var(--line);
      border-radius: 14px;
      overflow: hidden;
      contain: layout paint;
      backface-visibility: hidden;
      transform: translateZ(0);
    }

    @media (max-width: 430px) {
      .poster-canvas { height: min(58dvh, 120vw, 560px); }
    }

    @media (max-width: 360px) {
      h1 { font-size: clamp(1.9rem, 7.5vw, 2.6rem); }
      .poster-head .series { font-size: clamp(1.6rem, 9vw, 2.4rem); }
      .poster-head .date { font-size: clamp(.82rem, 3.8vw, 1rem); }
      .tag { font-size: .9rem; }
    }

    @media (min-width: 431px) and (max-width: 480px) {
      .poster-canvas { height: min(64dvh, 110vw, 600px); }
    }

    .poster-canvas canvas.trail {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 1;
    }

    .poster-logos {
      position: relative;
      padding: 10px 10px 0;
      border-top: 0;
      display: flex;
      gap: 12px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      row-gap: 6px;
      user-select: none;
      -webkit-user-select: none;
    }

    .poster-logos span.poster-sponsor {
      font-weight: 900;
      letter-spacing: .12em;
      font-size: .72rem;
      opacity: .95;
    }

    .bouncer {
      position: absolute;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: .16em .44em;
      border-radius: 6px;
      font-weight: 900;
      letter-spacing: .06em;
      text-transform: uppercase;
      white-space: nowrap;
      will-change: transform;
      box-shadow: 0 0 0 1px var(--line) inset;
      background: color-mix(in oklab, var(--bg) 96%, transparent);
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      z-index: 2;
    }

    .bouncer .dot {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 2px;
      background: var(--fg);
      margin-right: 2px;
      vertical-align: middle;
    }

    .bouncer .rc {
      display: none !important;
      align-items: center;
      gap: 6px;
      padding: .1rem .4rem;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: color-mix(in oklab, var(--bg) 96%, transparent);
      font-weight: 900;
    }

    .bouncer .lbl { transition: color .2s; }

    .bouncer.up-lit .lbl {
      color: var(--accent);
      text-shadow: 0 0 10px color-mix(in oklab, var(--accent) 40%, transparent);
    }

    /* ===== MAP ===== */
    .map {
      border: 1px solid var(--line);
      border-radius: 16px;
      overflow: hidden;
    }

    .map iframe {
      width: 100%;
      height: 320px;
      border: 0;
      display: block;
    }

    @media (min-width: 768px) {
      .map iframe { height: 360px; }
    }

    /* ===== FOOTER & FAB ===== */
    footer {
      border-top: 1px solid var(--line);
      padding: 28px 0;
      color: var(--muted);
      text-align: center;
    }

    .fab {
      position: fixed;
      right: 16px;
      bottom: 16px;
      width: 56px;
      height: 56px;
      border-radius: 999px;
      background: var(--accent);
      display: grid;
      place-items: center;
      box-shadow: 0 10px 22px rgba(0, 0, 0, .15);
      text-decoration: none;
      z-index: 80;
    }

    .fab svg { width: 26px; height: 26px; }
    .fab path { fill: var(--accent-fg); }

    /* ===== REVEAL ANIMATIONS ===== */
    .reveal {
      opacity: 0;
      transform: translateY(16px);
      transition: opacity .5s ease, transform .5s ease;
    }

    .reveal.active { opacity: 1; transform: translateY(0); }

    @media (prefers-reduced-motion: reduce) {
      .reveal { transition: none !important; }
    }

    /* ===== TOAST ===== */
    .toast {
      position: fixed;
      left: 50%;
      top: calc(var(--header-h) + 12px);
      transform: translateX(-50%) translateY(-8px);
      width: min(var(--max), calc(100% - 24px));
      background: color-mix(in oklab, var(--bg) 96%, transparent);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 12px 14px;
      box-shadow: 0 12px 28px rgba(0, 0, 0, .18);
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 400;
      z-index: 1100;
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
      flex-direction: column;
    }

    .toast.show { opacity: 1; pointer-events: auto; transform: translateX(-50%) translateY(0); }

    .toast .meta { opacity: .95; }
    .toast .x {
      margin-left: auto;
      border: 1px solid var(--line);
      background: var(--chip);
      color: var(--chip-fg);
      padding: 6px 10px;
      border-radius: 10px;
      font-weight: 900;
      cursor: pointer;
    }

    .toast .k { font-weight: 900; opacity: .95; }

    /* ===== PHOTO BUTTON & MODAL ===== */
    .photo-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid var(--line);
      background: var(--chip);
      color: var(--chip-fg);
      border-radius: 999px;
      padding: 3px 8px;
      font-weight: 800;
      font-size: 1rem;
      margin-left: 8px;
      cursor: pointer;
    }

    .photo-btn svg { width: 16px; height: 16px; }

    .modal {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(0, 0, 0, .55);
      z-index: 1200;
      opacity: 0;
      visibility: hidden;
      transition: opacity .18s ease;
      will-change: opacity;
      contain: paint;
      backface-visibility: hidden;
    }

    .modal.show {
      opacity: 1;
      visibility: visible;
    }

    html.modal-open, body.modal-open { overflow: hidden; }

    .modal__body {
      position: relative;
      background: var(--bg);
      border: 1px solid var(--line);
      border-radius: 16px;
      max-width: min(920px, 96vw);
      max-height: 90vh;
      padding: 10px;
      will-change: transform;
      transform: translateZ(0);
    }

    .modal__body img {
      display: block;
      max-width: 100%;
      max-height: 72vh;
      border-radius: 12px;
      object-fit: cover;
      image-rendering: auto;
    }

    .modal__close {
      position: absolute;
      right: 10px;
      top: 10px;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: var(--chip);
      color: var(--chip-fg);
      font-size: 22px;
      font-weight: 900;
      cursor: pointer;
    }

    .modal__caption {
      margin-top: 6px;
      text-align: center;
    }

    /* ===== PRIVATE EVENTS ===== */
    .private-events {
      background: color-mix(in oklab, var(--accent) 5%, transparent);
      border: 1px solid color-mix(in oklab, var(--accent) 20%, transparent);
      border-radius: 16px;
      padding: 20px;
      margin-top: 16px;
    }

    .private-events h4 {
      margin: 0 0 12px;
      font-family: 'Montserrat', system-ui, sans-serif;
      font-weight: 900;
      color: var(--accent);
    }

    .private-events-grid {
      display: grid;
      gap: 8px;
      margin: 12px 0;
    }

    .private-events-grid span {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }

    /* ===== LOADER ===== */
    .loader--ring {
      --s: 22px;
      --w: 3px;
      width: var(--s);
      height: var(--s);
      border-radius: 50%;
      display: inline-block;
      border: var(--w) solid color-mix(in oklab, var(--accent) 26%, transparent);
      border-top-color: var(--accent);
      animation: spin .8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .loader-overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      pointer-events: none;
      opacity: 1;
      transition: opacity .18s ease;
    }

    .loader-overlay.hidden { opacity: 0; }

    /* ===== CAROUSEL ===== */
    .live-box {
      position: relative;
      overflow: hidden;
      border: 1px solid var(--line);
      border-radius: 16px;
      background: color-mix(in oklab, var(--bg) 96%, transparent);
      contain: paint;
      backface-visibility: hidden;
    }

    #liveCarousel .slide {
      position: absolute;
      inset: 0;
      opacity: 0;
      transform: scale(1.01) translateZ(0);
      transition: opacity .4s ease, transform .4s ease;
      will-change: opacity, transform;
      backface-visibility: hidden;
    }

    #liveCarousel .slide.active {
      opacity: 1;
      transform: scale(1) translateZ(0);
    }

    #liveDots {
      position: absolute;
      left: 50%;
      bottom: 10px;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
      z-index: 2;
    }

    #liveDots .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: color-mix(in oklab, var(--fg) 24%, transparent);
      border: 0;
      cursor: pointer;
    }

    #liveDots .dot.active { background: var(--fg); }

    @media (prefers-reduced-motion: reduce) {
      #liveCarousel .slide { transition: none !important; }
      .modal { transition: none !important; }
    }

    /* ===== MENU ACCORDIONS GRID ===== */
    #menuAccordions { grid-template-columns: 1fr; }

    @media (min-width: 980px) {
      #menuAccordions { grid-template-columns: 1fr 1fr; }
    }
  
/* ===== APERITIVO – DEAL CARDS ===== */
.deals-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 12px;
}

.deal-card {
  display: grid;
  gap: 8px;
  border-radius: 16px;
  padding: 14px 16px;
  background: color-mix(in oklab, var(--bg, #0b0b0b) 96%, transparent);
  box-shadow: 0 8px 18px rgba(0,0,0,.12);
}

.deal-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

.deal-title {
  margin: 0;
  font-weight: 600;
  letter-spacing: .1px;
}

.deal-price {
  font-weight: 700;
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
}

.deal-desc {
  margin: 0;
  line-height: 1.45;
  opacity: .92;
}

#aperitivo .block-title {
  display: flex;
  align-items: baseline;
  gap: 12px;
  margin-bottom: 10px;
}

#aperitivo .block-title .meta {
  font-size: .95rem;
  opacity: .8;
}

.deals-note.meta {
  margin-top: 8px;
  opacity: .75;
  font-size: .9rem;
}


/* ---- Deal media (image on top) ---- */
.deal-media{
  width:100%;
  aspect-ratio: 16/10;
  border-radius: 14px;
  overflow:hidden;
  background: linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.05));
}

.deal-media > img{
  width:100%;
  height:100%;
  display:block;
  object-fit: cover;
}


/* Auto descriptions visibility control */
html.lang-it .desc--auto { display: none !important; }

</style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container">
      <nav aria-label="principale">
        <a class="brand" href="#">
          <img class="logo-light" src="https://cdn.shopify.com/s/files/1/0887/8332/3459/files/1719logooo.svg?v=1755102480" alt="17/19 Urban Bistrot - Logo"/>
          <img class="logo-dark" src="https://cdn.shopify.com/s/files/1/0887/8332/3459/files/1719logobianco.svg?v=1755104086" alt="17/19 Urban Bistrot - Logo (dark)"/>
        </a>

        <ul class="nav-desktop">
<li><a href="#about">About</a></li>
          <li><a href="#menu">Menu</a></li>
          <li><a href="#events">Eventi</a></li>
          <li><a href="#contact">Contatti</a></li>
          <li><a href="#private">Eventi Privati</a></li>
          <li><a class="pill pill--accent" href="#menu">Menù</a></li>
          <li><a class="pill pill--accent" href="https://wa.me/393298252092?text=Ciao%2017%2F19%20Urban%20Bistrot%2C%20vorrei%20prenotare" target="_blank" rel="noopener">Prenota</a></li>
          <li><button id="themeToggle" class="toggle" aria-label="Tema: automatico"></button></li>
          <li><button class="menu-toggle" id="menuToggleD" aria-label="Apri/chiudi menu"><span></span></button></li>
    <li><a href="#aperitivo">Aperitivo</a></li>
</ul>

        <div class="only-mobile" style="gap:8px;align-items:center">
          <a href="#menu" class="pill pill--accent pill--wide" aria-label="Vai al menù">Menù</a>
          <button id="themeToggleM" class="toggle" aria-label="Tema: automatico"></button>
          <button class="menu-toggle" id="menuToggle" aria-label="Apri/chiudi menu"><span></span></button>
        </div>
      </nav>
    </div>
  </header>

  <!-- Fullscreen Site Menu -->
  <div class="sheet" id="siteMenu" role="dialog" aria-hidden="true" aria-modal="true" aria-label="menu sito">
    <div class="sheet__panel">
      <button class="sheet__close" id="sheetClose" type="button" aria-label="Chiudi menu">×</button>
      <div class="sheet__inner">
        <ul class="sheet__list">
<li><a href="#about">About</a></li>
          <li><a href="#menu">Menu</a></li>
          <li><a href="#music">Musica</a></li>
          <li><a href="#events">Eventi</a></li>
          <li><a href="#private">Eventi Privati</a></li>
          <li><a href="#contact">Contatti</a></li>
    <li><a href="#aperitivo">Aperitivo</a></li>
</ul>
        <a class="pill pill--accent sheet__cta" href="https://wa.me/393298252092?text=Ciao%2017%2F19%20Urban%20Bistrot%2C%20vorrei%20prenotare" target="_blank" rel="noopener">Prenota</a>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="tipsToast" class="toast" role="region" aria-live="polite" aria-label="Interazioni">
    <div style="display:flex;align-items:center;gap:8px">
      <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3l7 7h-4v11H9V10H5l7-7z" fill="currentColor"/></svg>
      <strong>Interazioni</strong>
    </div>
    <div class="meta">
      Fai <strong>doppio tap</strong> per interagire con il nome dell'artista o sulla data dell'evento🔥<br/>
      Tante interazioni = tanto supporto!
    </div>
    <button class="x" aria-label="Chiudi">Chiudi</button>
  </div>

  <!-- Hero Section -->
  <section class="hero">
    <div class="container grid grid-2">
      <!-- Left Column: Poster or Live Shots -->
      <div class="reveal">
        <div class="poster-frame" id="posterFrame">
          <div class="poster-inner">
            <div class="poster-head">
              <div class="venue" id="posterVenue"></div>
              <div class="series" id="posterSeries"></div>
              <div class="date" id="posterDate"></div>
              <div class="tagline" id="posterTagline"></div>
              <div class="curated" id="posterCurated"></div>
            </div>
            <div class="poster-canvas" id="posterCanvas" aria-label="bouncer nomi"></div>
            <div class="poster-logos" id="posterLogos" aria-hidden="true"></div>
          </div>
        </div>
        <div class="hero-media" id="liveCarousel" aria-label="live shots">
          <div class="dots" id="liveDots"></div>
        </div>
        <span class="tag" style="margin-top:12px">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="margin-right:6px">
            <path d="M12 22s7-5.33 7-12a7 7 0 1 0-14 0c0 6.67 7 12 7 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
          </svg>
          Roma • Via di Santa Costanza 17/19
        </span>
      </div>

     <!-- Right Column: Hours + About -->
<div class="hero-right">
  <aside class="card reveal" aria-label="Orari e Servizio">
    <div class="block-title">
      <h3>Orari & Apertura</h3>
      <span class="meta">Servizio</span>
    </div>
    <div class="time-cards">
      <div class="time-card">
        <div class="l">
          <span class="i" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="16" rx="2" ry="2"/>
              <path d="M16 2v4M8 2v4M3 10h18"/>
            </svg>
          </span>
          <strong>Dal Martedì al Giovedì</strong>
        </div>
        <strong>08:00 – 00:00</strong>
      </div>

      <div class="time-card">
        <div class="l">
          <span class="i" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="16" rx="2" ry="2"/>
              <path d="M16 2v4M8 2v4M3 10h18"/>
            </svg>
          </span>
          <strong>Venerdì, Sabato e Domenica</strong>
        </div>
        <strong>08:00 – 01:00</strong>
      </div>

      <div class="time-card">
        <div class="l">
          <span class="i" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <line x1="4" y1="4" x2="20" y2="20"/>
              <rect x="3" y="4" width="18" height="16" rx="2" ry="2"/>
              <path d="M16 2v4M8 2v4M3 10h18"/>
            </svg>
          </span>
          <strong>Lunedì</strong>
        </div>
        <strong>Chiuso</strong>
      </div>
    </div>
  </aside>
</div>


        <div id="about" class="card reveal">
          <div class="block-title"><h3>Urban Bistrot</h3></div>
          <p style="margin:0">17/19 è un bistrot con cucina contemporanea: si pranza e si cena, si passa per un caffè, si resta per cocktail, aperitivo e dopocena. Facciamo anche eventi con musica dal vivo — line-up curata dai nostri <strong>resident DJ</strong>. Spazio polifunzionale aperto a tutti.</p>
        </div>
      </div>
    </div> 
<script>
document.querySelectorAll('#aperitivo .deal-media img[data-src]').forEach(img=>{
  const s = img.getAttribute('data-src'); if(s) img.src = s;
});
</script>
<!-- Menu Section -->
  <section id="menu">
    <div class="container">
      <div class="block-title" style="margin-bottom:6px"><h3>Il nostro menù</h3></div>
      <div id="menuAccordions" class="grid" style="gap:12px"></div>
    </div>
  </section>

<section id="aperitivo">
  <div class="container">
    <div class="block-title" style="margin-bottom:6px">
      <h3>Formule Aperitivo</h3>
      <span class="meta">Perfette da condividere</span>
    </div>

    <div class="grid deals-grid">
      <!-- Deal 1 -->
      <article class="card deal-card">
<figure class="deal-media">
<img loading="lazy" alt="Club sandwich, chips e calici" src="media/CLUBECALICI.webp" />
</figure>

        <div class="deal-top">
          <h4 class="deal-title">Per due — Club & Calici</h4>
          <span class="deal-price">26&nbsp;€</span>
        </div>
        <p class="deal-desc">
          Club sandwich, chips artigianali con salse, <strong>2 calici</strong> a scelta
          (vino, spritz o birra).
        </p>
      </article>

      <!-- Deal 2 -->
      <article class="card deal-card">
<figure class="deal-media">
<img loading="lazy" alt="GranTagliere, focaccia e calici" src="/media/calici%20e%20tagliere.webp" />
</figure>
        <div class="deal-top">
          <h4 class="deal-title">Per due — Gran Tagliere & Calici</h4>
          <span class="deal-price">46&nbsp;€</span>
        </div>
        <p class="deal-desc">
          Gran tagliere (selezione di affettati e formaggi), focaccia, <strong>2 calici</strong>
          (vino, spritz o birra).
        </p>
      </article>

      <!-- Deal 3 -->
      <article class="card deal-card">
<figure class="deal-media">
<img loading="lazy" alt="GranTagliere, focaccia e bottiglia" src="/media/bottiglia%20e%20tagliere.webp" />
</figure>

        <div class="deal-top">
          <h4 class="deal-title">Mega per due — Tagliere & Bottiglia</h4>
          <span class="deal-price">55&nbsp;€</span>
        </div>
        <p class="deal-desc">
          Gran tagliere (selezione di affettati e formaggi), focaccia, <strong>1 bottiglia</strong>
          di vino selezionata.
        </p>
      </article>

      <!-- Deal 4 -->
      <article class="card deal-card">
<figure class="deal-media">
  <img loading="lazy" alt="Chips e calice" src="media/CHIPSECALICE.webp" />
</figure>

        <div class="deal-top">
          <h4 class="deal-title">Chips & Calice</h4>
          <span class="deal-price">11&nbsp;€</span>
        </div>
        <p class="deal-desc">
          Chips artigianali con salse e <strong>1 calice</strong> (vino, spritz o birra).
        </p>
      </article>
    </div>

    <div class="deals-note meta" role="note" aria-label="note aperitivo">
     Chiedi al banco le proposte del giorno.
    </div>
  </div>
</section>



<!-- LightWidget WIDGET --><script src="https://cdn.lightwidget.com/widgets/lightwidget.js"></script><iframe src="https://cdn.lightwidget.com/widgets/7e6a879b50645920bcae1d9dccaf9fc6.html" scrolling="no" allowtransparency="true" class="lightwidget-widget" style="width:100%;border:0;overflow:hidden;"></iframe>
  
  <!-- Private Events Section -->
  <section id="private">
    <div class="container">
      <div class="card reveal">
        <div class="block-title">
          <h3>Eventi Privati</h3>
          <span class="meta">Location esclusiva</span>
        </div>
        <p>17/19 Urban Bistrot è la location perfetta per i tuoi eventi privati. Organizziamo con cura ogni dettaglio per rendere speciale la tua occasione.</p>
        
        <div class="private-events">
          <h4>Che tipo di eventi organizziamo:</h4>
          <div class="private-events-grid">
            <span>🎂 Compleanni e feste private</span>
            <span>🎓 Feste di laurea</span>
            <span>🍽️ Cene di gruppo e aziendali</span>
            <span>🎉 Aperitivi e cocktail party</span>
            <span>🎵 Eventi con DJ set personalizzati</span>
          </div>
          <p style="margin:12px 0 16px;font-size:.95rem;color:var(--muted)">
            Spazio dedicato al piano superiore, servizio alla carta o catering, impianto audio e atmosfera unica nel cuore di Roma.
          </p>
          <a class="pill pill--accent" href="https://wa.me/393298252092?text=Ciao%2017%2F19%20Urban%20Bistrot%2C%20vorrei%20organizzare%20un%20evento%20privato" target="_blank" rel="noopener">
            Richiedi Preventivo
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Events Section -->
  <section id="events">
    <div class="container">
      <div class="block-title" style="margin-bottom:6px"><h3>Prossimi Eventi</h3></div>
      <div class="grid" id="eventsList" style="gap:12px"></div>
      <div class="events-more">
        <button id="eventsMoreBtn" class="pill pill--ghost" type="button">Mostra altri</button>
      </div>
    </div>
  </section>

  <!-- Contact Section -->
  <section id="contact">
    <div class="container grid grid-2">
      <div class="card reveal">
        <div class="block-title"><h3>Contatti</h3></div>
        <p><strong>Indirizzo</strong><br/>Via di Santa Costanza 17/19 – 00198 Roma</p>
        <p><strong>Prenotazioni</strong><br/>
          WhatsApp: <a class="pill" href="https://wa.me/393298252092" target="_blank" rel="noopener">+39 329 825 2092</a><br/>
          <br/>
          Email: <a class="pill" href="mailto:info@1719bistrot.it">info@1719bistrot.it</a>
        </p>
        <p><strong>Social</strong><br/>
          <a class="pill" href="https://instagram.com/1719urban_bistrot" target="_blank" rel="noopener">Instagram</a>
        </p>
      </div>

      <div class="card reveal">
        <div class="block-title">
          <h3>Dove siamo</h3>
          <a class="pill pill--accent" href="https://maps.app.goo.gl/DH48FCh9wvF6mF8p6" target="_blank" rel="noopener">Apri su Google Maps</a>
        </div>
        <div class="map">
          <iframe title="Mappa 17/19 Urban Bistrot" loading="lazy" referrerpolicy="no-referrer-when-downgrade"
            src="https://www.google.com/maps?q=17%2F19%20Cocktail%20Bar%2C%20Via%20di%20Santa%20Costanza%2017%2F19%2C%20Roma&ll=41.9226278,12.514469&z=17&output=embed"></iframe>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container"><p>&copy; 2025 17/19 Urban Bistrot Roma</p></div>
  </footer>

  <!-- WhatsApp FAB -->
  <a class="fab" href="https://wa.me/393298252092?text=Ciao%2017%2F19%20Urban%20Bistrot" target="_blank" rel="noopener" aria-label="WhatsApp">
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M12 1.5c5.8 0 10.5 4.7 10.5 10.5S17.8 22.5 12 22.5A10.5 10.5 0 0 1 6.99 21.23L3 21l.82-3.89A10.45 10.45 0 0 1 1.5 12C1.5 6.2 6.2 1.5 12 1.5Z" fill="currentColor" opacity=".96"/>
      <path d="M16.63 14.62c-.19-.1-1.13-.6-1.3-.66-.17-.06-.29-.1-.42.1s-.49.66-.6.8c-.11.13-.22.15-.41.06-.19-.1-.81-.3-1.55-.98-.57-.51-.95-1.13-1.06-1.31-.11-.19-.01-.29.09-.39.09-.09.2-.24.29-.36.1-.12.13-.2.19-.33.06-.13.03-.25-.02-.35-.05-.1-.44-1.05-.6-1.45-.16-.39-.33-.33-.45-.34h-.38c-.13 0-.33.05-.5.24-.17.19-.66.65-.66 1.59 0 .94.68 1.85.78 2 .1.13 1.31 2.07 3.2 2.91.45.2.8.32 1.04.41.44.15.85.13 1.17.08.36-.05 1.1-.45 1.25-.89.15-.44.15-.82.11-.91-.05-.08-.16-.13-.41-.25Z" fill="#fff"/>
    </svg>
  </a>

  <!-- Photo Modal -->
  <div class="modal" id="photoModal" aria-hidden="true" aria-modal="true" role="dialog">
    <div class="modal__body">
      <button class="modal__close" type="button" aria-label="Chiudi">×</button>
      <img id="modalPhoto" alt="Foto prodotto">
      <div id="modalCaption" class="modal__caption meta"></div>
    </div>
  </div>

  <!-- Global Loader -->
  <div id="globalLoader" style="position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.35);z-index:1300">
    <span class="loader--ring" aria-label="Caricamento"></span>
  </div>

  <script>
    // ===== CONFIGURATION =====
    const CONFIG = {
      SHOW_SPONSORS_IN_CARD: false,
      KEY: 'eventreactions1719',
      PERSIST_REMOTE: {
        enabled: true,
        endpoint: 'https://script.google.com/macros/s/AKfycbyukoQfi8AKrj0dtGGU4gRCCjWMA8Aik1E1s1ssTmWazIEGk0yJjdavqsWd4LE0_Z4/exec?key=eventreactions1719'
      },
      SHOW_POSTER: false, // false = mostra live shots, true = mostra poster
      PHYS: {
        base: 42, rand: 18,
        damping: 0.996,
        restitution: 0.92,
        wallRestitution: 0.90,
        min: 18, max: 160,
        measureEvery: 12,
        pad: -6,
        sepBias: 1.2,
        nudge: 8,
        boostMax: 4.5,
        burstMs: 900,
        randomResolveMod: 4
      }
    };

    // ===== UTILITY FUNCTIONS =====
    const $ = (s, r = document) => r.querySelector(s);
    const $$ = (s, r = document) => Array.from(r.querySelectorAll(s));
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
    const slug = s => String(s || '').toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9\-]/g, '');
    const UUID = () => crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(36).slice(2) + '-' + Date.now();
    const deviceId = (() => {
      const k = '1719-device';
      let d = localStorage.getItem(k);
      if (!d) {
        d = UUID();
        localStorage.setItem(k, d);
      }
      return d;
    })();

    const SVG = {
      up: `<svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3l7 7h-4v11H9V10H5l7-7z" fill="currentColor"/></svg>`,
      help: `<svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 1 1 5.83 1c0 2-3 2-3 4"/><path d="M12 17h.01"/></svg>`,
      share: `<svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M18 8a3 3 0 1 0-2.83-4h0A3 3 0 0 0 18 8ZM6 14a3 3 0 1 0-2.83 4h0A3 3 0 0 0 6 14ZM18 16a3 3 0 1 0 2.83 4h0A3 3 0 0 0 18 16Z" fill="currentColor"/><path d="M8.59 13.51l6.82-3.02M8.59 16.49l6.82 3.02" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg>`
    };

    // ===== SCROLL REVEAL =====
    const reveals = document.querySelectorAll('.reveal');
    const io = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          e.target.classList.add('active');
          io.unobserve(e.target);
        }
      });
    }, { threshold: .14 });
    reveals.forEach(el => io.observe(el));

    // ===== HEADER SCROLL EFFECT =====
    const header = document.querySelector('header');
    const onScroll = () => {
      header.classList.toggle('header--solid', window.scrollY > 8);
    };
    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();

    // ===== FULLSCREEN MENU =====
    const siteMenu = document.getElementById('siteMenu');
    const sheetClose = document.getElementById('sheetClose');
    const panel = siteMenu.querySelector('.sheet__panel');
    const inner = siteMenu.querySelector('.sheet__inner');
    const toggleBtns = [document.getElementById('menuToggle'), document.getElementById('menuToggleD')].filter(Boolean);

    const openMenu = () => {
      siteMenu.classList.add('active');
      siteMenu.setAttribute('aria-hidden', 'false');
      document.body.classList.add('menu-open');
    };

    const closeMenu = () => {
      siteMenu.classList.remove('active');
      siteMenu.setAttribute('aria-hidden', 'true');
      document.body.classList.remove('menu-open');
    };

    toggleBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        siteMenu.classList.contains('active') ? closeMenu() : openMenu();
      });
    });

    sheetClose.addEventListener('click', (e) => {
      e.stopPropagation();
      closeMenu();
    });

    panel.addEventListener('click', (e) => {
      if (!inner.contains(e.target)) closeMenu();
    });

    inner.addEventListener('click', (e) => e.stopPropagation());

    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeMenu();
    });

    siteMenu.querySelectorAll('a').forEach(a => {
      a.addEventListener('click', () => setTimeout(closeMenu, 80));
    });

    // ===== EXTERNAL LINKS FIX =====
    (function() {
      document.querySelectorAll('a[href^="http"]').forEach(a => {
        try {
          const u = new URL(a.getAttribute('href'), location.href);
          if (u.origin !== location.origin) {
            a.setAttribute('target', '_blank');
            a.setAttribute('rel', 'noopener');
          }
        } catch {}
      });

      document.addEventListener('click', function(e) {
        const a = e.target.closest('a[href]');
        if (!a) return;
        
        const href = a.getAttribute('href');
        if (!href) return;
        
        if (href.startsWith('#') || href.startsWith('mailto:') || href.startsWith('tel:') || href.startsWith('javascript:')) return;
        
        let isExternal = false;
        try {
          isExternal = (new URL(href, location.href).origin !== location.origin);
        } catch {}
        
        const openNewTab = isExternal || a.getAttribute('target') === '_blank';
        if (openNewTab) {
          e.preventDefault();
          e.stopImmediatePropagation();
          const win = window.open(href, '_blank');
          if (!win) {
            location.href = href;
          }
        }
      }, true);
    })();

    // ===== THEME MANAGEMENT =====
    const THEME_KEY = 'theme-1719';
    const root = document.documentElement;

    function applyTheme(mode) {
      root.setAttribute('data-theme', mode);
      localStorage.setItem(THEME_KEY, mode);
      paintThemeIcon(mode);
    }

    function paintThemeIcon(mode) {
      const svgAuto = `<svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><circle cx="12" cy="12" r="5" fill="currentColor" opacity=".9"/><text x="12" y="22" text-anchor="middle" font-size="7" font-family="monospace" fill="currentColor" opacity=".9">AUTO</text></svg>`;
      const svgSun = `<svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2m0 16v2M2 12h2m16 0h2M4.9 4.9l1.4 1.4M17.7 17.7l1.4 1.4M4.9 19.1l1.4-1.4M17.7 6.3l1.4-1.4"/></svg>`;
      const svgMoon = `<svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;
      
      const icon = mode === 'auto' ? svgAuto : mode === 'light' ? svgSun : svgMoon;
      document.querySelectorAll('#themeToggle, #themeToggleM').forEach(btn => btn.innerHTML = icon);
    }

    function cycleTheme() {
      const cur = root.getAttribute('data-theme') || 'auto';
      const next = cur === 'auto' ? 'light' : cur === 'light' ? 'dark' : 'auto';
      applyTheme(next);
    }

    document.getElementById('themeToggle')?.addEventListener('click', cycleTheme);
    document.getElementById('themeToggleM')?.addEventListener('click', cycleTheme);
    applyTheme(localStorage.getItem(THEME_KEY) || 'auto');

    // ===== TOAST MANAGEMENT =====
    const toast = document.getElementById('tipsToast');
    let toastTimer = null;

    function openToast() {
      toast.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toast.classList.remove('show'), 10000);
    }

    function closeToast() {
      toast.classList.remove('show');
      clearTimeout(toastTimer);
    }

    function toggleToast() {
      if (toast.classList.contains('show')) closeToast();
      else openToast();
    }

    document.getElementById('tipsBtn')?.addEventListener('click', toggleToast);
    document.getElementById('tipsBtnM')?.addEventListener('click', toggleToast);
    toast.querySelector('.x').addEventListener('click', closeToast);

    // ===== LIVE CAROUSEL =====
    const liveImages = [
      '/media/carosello1.webp',
      '/media/carosello2.webp',
      '/media/carosello3.webp',
      '/media/carosello4.webp',
    ];

    function setupLiveCarousel() {
      const box = document.getElementById('liveCarousel');
      const dots = document.getElementById('liveDots');
      if (!box) return;

      // Ensure container classes
      box.classList.add('live-box');

      // Clear existing content
      box.innerHTML = '';
      if (dots) dots.innerHTML = '';

      // Local loader
      const overlay = document.createElement('div');
      overlay.className = 'loader-overlay';
      overlay.innerHTML = '<span class="loader--ring" aria-hidden="true"></span>';
      box.appendChild(overlay);

      let currentIndex = 0;
      const slides = [];
      const bullets = [];

      // Create slides and dots
      liveImages.forEach((src, idx) => {
        const slide = document.createElement('div');
        slide.className = `slide ${idx === 0 ? 'active' : ''}`;
        
        const img = new Image();
        img.alt = `Live ${idx + 1}`;
        img.decoding = 'async';
        img.loading = idx < 2 ? 'eager' : 'lazy';
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'cover';
        
        img.addEventListener('load', () => {
          if (idx === 0) {
            overlay.classList.add('hidden');
          }
        });
        
        img.src = src;
        slide.appendChild(img);
        box.appendChild(slide);
        slides.push(slide);

        // Create dots
        if (dots) {
          const dot = document.createElement('button');
          dot.className = `dot ${idx === 0 ? 'active' : ''}`;
          dot.addEventListener('click', () => goToSlide(idx));
          dots.appendChild(dot);
          bullets.push(dot);
        }
      });

      if (dots) box.appendChild(dots);

      function goToSlide(index) {
        if (index === currentIndex || index < 0 || index >= slides.length) return;
        
        // Preload next image if not complete
        const img = slides[index].querySelector('img');
        if (img && !img.complete) {
          overlay.classList.remove('hidden');
          img.addEventListener('load', () => overlay.classList.add('hidden'), { once: true });
        }

        // Update active states
        requestAnimationFrame(() => {
          slides[currentIndex].classList.remove('active');
          slides[index].classList.add('active');
          
          if (bullets[currentIndex]) bullets[currentIndex].classList.remove('active');
          if (bullets[index]) bullets[index].classList.add('active');
          
          currentIndex = index;
        });
      }

      // Touch/swipe handlers
      let startX = 0, startY = 0, deltaX = 0, deltaY = 0, isTouching = false;
      const THRESHOLD = 40;

      function onTouchStart(e) {
        const t = e.touches ? e.touches[0] : e;
        startX = t.clientX;
        startY = t.clientY;
        deltaX = 0;
        deltaY = 0;
        isTouching = true;
      }

      function onTouchMove(e) {
        if (!isTouching) return;
        const t = e.touches ? e.touches[0] : e;
        deltaX = t.clientX - startX;
        deltaY = t.clientY - startY;
      }

      function onTouchEnd() {
        if (!isTouching) return;
        isTouching = false;
        
        if (Math.abs(deltaX) > Math.max(THRESHOLD, Math.abs(deltaY))) {
          if (deltaX < 0) {
            goToSlide((currentIndex + 1) % slides.length);
          } else {
            goToSlide((currentIndex - 1 + slides.length) % slides.length);
          }
        }
      }

      box.addEventListener('touchstart', onTouchStart, { passive: true });
      box.addEventListener('touchmove', onTouchMove, { passive: true });
      box.addEventListener('touchend', onTouchEnd, { passive: true });

      // Auto-advance (optional)
      // setInterval(() => goToSlide((currentIndex + 1) % slides.length), 5000);
    }

    // ===== STORE (LOCAL + REMOTE) =====
    const Store = {
      key: '1719-reactions-v6',
      state: {
        aggRocketsByName: {},
        myFlamesByEvent: {},
        aggFlamesByEvent: {},
        totals: { rockets: 0, flames: 0, devices: 0 }
      },
      logQueue: [],

      load() {
        try {
          const s = localStorage.getItem(this.key);
          if (s) {
            this.state = { ...this.state, ...JSON.parse(s) };
          }
        } catch (e) {}
      },

      saveLocal() {
        try {
          localStorage.setItem(this.key, JSON.stringify(this.state));
        } catch (e) {}
      },

      // Getters
      getRocketsAgg(name) {
        return this.state.aggRocketsByName[String(name || '').toUpperCase()] || 0;
      },

      getFlameCount(eid) {
        return this.state.aggFlamesByEvent[eid] || 0;
      },

      getMyFlame(eid) {
        return this.state.myFlamesByEvent[eid] || 0;
      },

      // Actions
      incRocket({ name, ctx }) {
        if (!name) return 0;
        
        const NAME = String(name).toUpperCase();
        this.enqueueLog({ type: 'name_upvote', name: NAME, ctx });
        
        // Optimistic UI update
        this.state.aggRocketsByName[NAME] = (this.state.aggRocketsByName[NAME] || 0) + 1;
        this.state.totals.rockets = Object.values(this.state.aggRocketsByName).reduce((a, b) => a + b, 0);
        
        this.saveLocal();
        this.remotePushDebounced();
        return this.getRocketsAgg(NAME);
      },

      toggleFlame({ eid, on, ctx }) {
        const cur = this.getMyFlame(eid);
        const next = (on != null) ? (on ? 1 : 0) : (cur ? 0 : 1);
        
        this.state.myFlamesByEvent[eid] = next;

        // Optimistic UI update
        const agg = this.getFlameCount(eid);
        const newAgg = clamp(agg + (next - cur), 0, 1e9);
        this.state.aggFlamesByEvent[eid] = newAgg;
        this.state.totals.flames = Object.values(this.state.aggFlamesByEvent).reduce((a, b) => a + b, 0);

        this.enqueueLog({ type: 'event_vote', eid, on: next, ctx });
        this.saveLocal();
        this.remotePushDebounced();
        return next;
      },

      enqueueLog(entry) {
        const when = new Date().toISOString();
        const ua = navigator.userAgent || '';
        const page = location.href;
        this.logQueue.push({ ...entry, when, deviceId, ua, page });
        
        if (this.logQueue.length > 50) this.remotePush();
      },

      // Remote persistence
      remotePull() {
        if (!CONFIG.PERSIST_REMOTE.enabled || !CONFIG.PERSIST_REMOTE.endpoint) return Promise.resolve();
        
        return new Promise((resolve) => {
          const callbackName = 'CB_' + Math.random().toString(36).slice(2);
          
          window[callbackName] = (data) => {
            try {
              if (data && typeof data === 'object') {
                this.state.aggRocketsByName = data.rocketsByName || {};
                this.state.aggFlamesByEvent = data.flamesByEvent || {};
                this.state.totals = data.totals || this.state.totals;
                this.saveLocal();
                
                if (typeof updateEventCountsFromStore === 'function') updateEventCountsFromStore();
                if (typeof updatePosterChipCounts === 'function') updatePosterChipCounts();
              }
            } finally {
              delete window[callbackName];
              script.remove();
              resolve();
            }
          };

          const script = document.createElement('script');
          script.src = CONFIG.PERSIST_REMOTE.endpoint + '&callback=' + callbackName;
          script.onerror = () => {
            delete window[callbackName];
            script.remove();
            resolve();
          };
          
          document.head.appendChild(script);
        });
      },

      async remotePush() {
        if (!CONFIG.PERSIST_REMOTE.enabled || !CONFIG.PERSIST_REMOTE.endpoint) return;
        
        try {
          const logs = this.logQueue.splice(0);
          if (!logs.length) return;
          
          const body = JSON.stringify({ key: CONFIG.KEY, logs });
          const blob = new Blob([body], { type: 'text/plain;charset=utf-8' });
          
          if (navigator.sendBeacon) {
            navigator.sendBeacon(CONFIG.PERSIST_REMOTE.endpoint, blob);
          } else {
            await fetch(CONFIG.PERSIST_REMOTE.endpoint, { method: 'POST', mode: 'no-cors', body: blob });
          }
          
          // Pull for sync after push
          setTimeout(() => this.remotePull(), 600);
        } catch (e) {}
      },

      remotePushDebounced: (() => {
        let timeout;
        return function() {
          clearTimeout(timeout);
          timeout = setTimeout(() => this.remotePush(), 400);
        };
      })()
    };

    // Initialize store
    Store.load();
    Store.remotePull();
    setInterval(() => Store.remotePull(), 20000); // Live-ish updates

    // ===== DOUBLE-TAP HANDLER =====
    function makeDoubleTap(el, handler, threshold = 300, moveTolerance = 18) {
      let lastTime = 0, lastX = 0, lastY = 0;
      
      el.addEventListener('pointerdown', (e) => {
        if (e.pointerType !== 'mouse') e.preventDefault();
        e.stopPropagation();
        
        const now = performance.now();
        const x = e.clientX, y = e.clientY;
        const dt = now - lastTime;
        const dist = Math.hypot(x - lastX, y - lastY);
        
        if (dt < threshold && dist < moveTolerance) {
          lastTime = 0;
          handler(e);
        } else {
          lastTime = now;
          lastX = x;
          lastY = y;
        }
      }, { passive: false });
      
      el.addEventListener('dblclick', (e) => {
        e.preventDefault();
        e.stopPropagation();
      }, { passive: false });
    }

    // ===== POSTER/BOUNCERS =====
    const posterData = {
      venue: '17/19 URBAN BISTROT',
      series: 'ELECTRO TECHNO NIGHT',
      date: 'WEDNESDAY 03/09',
      tagline: 'TECHNO • ELECTRO • VINYL',
      curatedBy: 'CURATED BY RESIDENT DJS',
      logos: [{ text: 'CASAMIGOS' }, { text: 'ORGANICS' }, { text: 'UPVOTES' }]
    };

    let currentPosterEventCtx = null;
    const posterCanvas = document.getElementById('posterCanvas');
    let bounceRAF = null, bouncers = [];
    let trailCanvas = null, trailCtx = null, trailRO = null;
    let collisionBurstUntil = 0;
    let frameCounter = 0;

    function setPosterTexts(p) {
      const set = (id, txt) => {
        const el = document.getElementById(id);
        if (el) el.textContent = (txt || '').toUpperCase();
      };
      
      set('posterVenue', p.venue);
      set('posterSeries', p.series);
      set('posterDate', p.date);
      set('posterTagline', p.tagline);
      set('posterCurated', p.curatedBy);
      
      const logosWrap = document.getElementById('posterLogos');
      if (logosWrap) {
        logosWrap.innerHTML = '';
        (p.logos || []).forEach(L => {
          const span = document.createElement('span');
          span.className = 'poster-sponsor';
          span.textContent = (L.text || '').toUpperCase();
          logosWrap.appendChild(span);
        });
      }
    }

    function setupTrailCanvas() {
      if (trailCanvas) return;
      
      trailCanvas = document.createElement('canvas');
      trailCanvas.className = 'trail';
      posterCanvas.appendChild(trailCanvas);
      trailCtx = trailCanvas.getContext('2d');
      
      const resize = () => {
        const w = posterCanvas.clientWidth | 0;
        const h = posterCanvas.clientHeight | 0;
        trailCanvas.width = w;
        trailCanvas.height = h;
        trailCtx.clearRect(0, 0, w, h);
      };
      
      resize();
      
      if ('ResizeObserver' in window) {
        trailRO = new ResizeObserver(resize);
        trailRO.observe(posterCanvas);
      } else {
        window.addEventListener('resize', resize);
      }
    }

    function easeInOutCubic(t) {
      return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
    }

    function sparkle(x, y) {
      if (!trailCtx) return;
      
      const parts = 10;
      for (let i = 0; i < parts; i++) {
        ((i) => {
          const angle = Math.random() * Math.PI * 2;
          const velocity = 40 + Math.random() * 80;
          const life = 250 + Math.random() * 350;
          const start = performance.now();
          
          function tick(now) {
            const t = Math.min(1, (now - start) / life);
            const px = x + Math.cos(angle) * velocity * t;
            const py = y + Math.sin(angle) * velocity * t;
            
            trailCtx.save();
            trailCtx.globalCompositeOperation = 'lighter';
            trailCtx.fillStyle = `rgba(255, 31, 61, ${1 - t})`;
            trailCtx.beginPath();
            trailCtx.arc(px, py, 2 * (1 - t), 0, Math.PI * 2);
            trailCtx.fill();
            trailCtx.restore();
            
            if (t < 1) requestAnimationFrame(tick);
          }
          
          requestAnimationFrame(tick);
        })(i);
      }
    }

    function clearBouncers() {
      cancelAnimationFrame(bounceRAF);
      bouncers.forEach(b => b.el.remove());
      bouncers = [];
      
      if (trailCtx) {
        trailCtx.clearRect(0, 0, trailCanvas.width, trailCanvas.height);
      }
    }

    function triggerUpvote(targetEl) {
      const b = bouncers.find(x => x.el === targetEl);
      if (!b) return;
      
      const name = targetEl.dataset.name || '';
      const now = performance.now();
      const DURATION = 1100, BOOST = CONFIG.PHYS.boostMax;
      
      b.boost = { start: now, end: now + DURATION, max: BOOST };
      targetEl.classList.add('up-lit');

      // Update counter and log
      const count = Store.incRocket({ name, ctx: currentPosterEventCtx });
      const countEl = targetEl.querySelector('.rc .n');
      if (countEl) countEl.textContent = count;

      // Scale animation
      targetEl.style.transform += ' scale(1.06)';
      setTimeout(() => {
        targetEl.style.transform = targetEl.style.transform.replace(' scale(1.06)', '');
      }, 140);

      // Sparkles
      const cx = b.x + b.w / 2, cy = b.y + b.h / 2;
      sparkle(cx, cy);
      b.trailPulseUntil = now + DURATION;

      // Collision burst
      collisionBurstUntil = performance.now() + CONFIG.PHYS.burstMs;

      // Recalculate dimensions if number grows
      const rect = targetEl.getBoundingClientRect();
      b.w = rect.width;
      b.h = rect.height;
      b.r = Math.max(14, 0.25 * (b.w + b.h));
    }

    function limitVelocity(b) {
      const speed = Math.hypot(b.vx, b.vy) || 0.0001;
      
      if (speed < CONFIG.PHYS.min) {
        const factor = CONFIG.PHYS.min / speed;
        b.vx *= factor;
        b.vy *= factor;
      }
      
      if (speed > CONFIG.PHYS.max) {
        const factor = CONFIG.PHYS.max / speed;
        b.vx *= factor;
        b.vy *= factor;
      }
    }

    function initBouncers(names) {
      clearBouncers();
      setupTrailCanvas();
      
      const rect = posterCanvas.getBoundingClientRect();
      names.forEach((name, idx) => {
        const el = document.createElement('div');
        el.className = 'bouncer';
        el.dataset.name = name.toUpperCase();
        el.innerHTML = `<span class="dot"></span><span class="lbl">${name}</span><span class="rc">${SVG.up}<span class="n">${Store.getRocketsAgg(name)}</span></span>`;
        posterCanvas.appendChild(el);

        const w = el.offsetWidth || 80;
        const h = el.offsetHeight || 28;
        const r = Math.max(14, 0.25 * (w + h));

        // Spawn without overlap (max 20 attempts)
        let x = 0, y = 0;
        for (let tries = 0; tries < 20; tries++) {
          x = Math.random() * Math.max(1, rect.width - w);
          y = Math.random() * Math.max(1, rect.height - h);
          
          const overlap = bouncers.some(o => {
            const ax = x + w / 2, ay = y + h / 2;
            const bx = o.x + o.w / 2, by = o.y + o.h / 2;
            const d = Math.hypot(bx - ax, by - ay);
            return d < (r + o.r + 2);
          });
          
          if (!overlap) break;
        }

        const speed = CONFIG.PHYS.base + Math.random() * CONFIG.PHYS.rand;
        const angle = Math.random() * Math.PI * 2;
        const vx = Math.cos(angle) * speed;
        const vy = Math.sin(angle) * speed;

        bouncers.push({ el, x, y, w, h, r, vx, vy, boost: null, trailPulseUntil: 0 });
        makeDoubleTap(el, () => triggerUpvote(el));
      });

      let lastTime = performance.now();
      frameCounter = 0;

      const tick = (now) => {
        const dt = (now - lastTime) / 1000;
        lastTime = now;
        const W = posterCanvas.clientWidth, H = posterCanvas.clientHeight;

        // Fade trail
        if (trailCtx && (trailCanvas.width !== W || trailCanvas.height !== H)) {
          trailCanvas.width = W;
          trailCanvas.height = H;
        }
        
        if (trailCtx) {
          trailCtx.save();
          trailCtx.globalCompositeOperation = 'destination-out';
          trailCtx.fillStyle = 'rgba(0, 0, 0, 0.08)';
          trailCtx.fillRect(0, 0, W, H);
          trailCtx.restore();
        }

        // Update bouncers
        bouncers.forEach(b => {
          // Damping
          b.vx *= CONFIG.PHYS.damping;
          b.vy *= CONFIG.PHYS.damping;

          // Boost
          if (b.boost && now < b.boost.end) {
            const t = (now - b.boost.start) / (b.boost.end - b.boost.start);
            const e = easeInOutCubic(clamp(t, 0, 1));
            const factor = 1 + e * (b.boost.max - 1);
            b.vx *= factor;
            b.vy *= factor;

            // Trail pulse
            if (trailCtx) {
              const cx = b.x + b.w / 2, cy = b.y + b.h / 2;
              const len = 10 + 30 * e;
              const norm = Math.hypot(b.vx, b.vy) || 1;
              const bx = cx - (b.vx / norm) * len;
              const by = cy - (b.vy / norm) * len;
              
              trailCtx.save();
              trailCtx.globalCompositeOperation = 'lighter';
              trailCtx.lineWidth = 1 + 2 * e;
              trailCtx.strokeStyle = `rgba(255, 31, 61, ${0.45 + 0.25 * e})`;
              trailCtx.beginPath();
              trailCtx.moveTo(bx, by);
              trailCtx.lineTo(cx, cy);
              trailCtx.stroke();
              trailCtx.restore();
            }
          } else if (b.boost && now >= b.boost.end) {
            b.boost = null;
            b.el.classList.remove('up-lit');
          }

          // Integration
          let nx = b.x + b.vx * dt;
          let ny = b.y + b.vy * dt;

          // Walls
          if (nx <= 0) { nx = 0; b.vx = Math.abs(b.vx) * CONFIG.PHYS.wallRestitution; }
          if (ny <= 0) { ny = 0; b.vy = Math.abs(b.vy) * CONFIG.PHYS.wallRestitution; }
          if (nx + b.w >= W) { nx = W - b.w; b.vx = -Math.abs(b.vx) * CONFIG.PHYS.wallRestitution; }
          if (ny + b.h >= H) { ny = H - b.h; b.vy = -Math.abs(b.vy) * CONFIG.PHYS.wallRestitution; }

          limitVelocity(b);

          // Apply
          b.x = nx;
          b.y = ny;
          b.el.style.transform = `translate(${nx}px, ${ny}px)`;
        });

        // Periodic dimension recalculation
        if ((frameCounter % CONFIG.PHYS.measureEvery) === 0) {
          bouncers.forEach(b => {
            const br = b.el.getBoundingClientRect();
            b.w = br.width;
            b.h = br.height;
            b.r = Math.max(14, 0.25 * (b.w + b.h));
          });
        }

        // Collisions
        resolveCollisions();

        frameCounter++;
        bounceRAF = requestAnimationFrame(tick);
      };
      
      bounceRAF = requestAnimationFrame(tick);
    }

    function resolveCollisions() {
      const e = CONFIG.PHYS.restitution;
      
      for (let i = 0; i < bouncers.length; i++) {
        for (let j = i + 1; j < bouncers.length; j++) {
          const a = bouncers[i], b = bouncers[j];

          // Centers
          const ax = a.x + a.w / 2, ay = a.y + a.h / 2;
          const bx = b.x + b.w / 2, by = b.y + b.h / 2;

          const dx = bx - ax, dy = by - ay;
          const dist2 = dx * dx + dy * dy;
          const minD = (a.r + b.r) + CONFIG.PHYS.pad;
          
          if (dist2 < minD * minD) {
            const dist = Math.max(Math.sqrt(dist2), 1e-6);
            let nx = dx / dist, ny = dy / dist;

            // Positional correction
            const penetration = minD - dist;
            const percent = 0.20;
            const correction = Math.max(penetration, 0) * percent;
            
            a.x -= nx * correction;
            a.y -= ny * correction;
            b.x += nx * correction;
            b.y += ny * correction;

            // Elastic impulse if approaching
            const rvx = b.vx - a.vx;
            const rvy = b.vy - a.vy;
            const velAlongNormal = rvx * nx + rvy * ny;

            if (velAlongNormal < 0) {
              const impulse = -(1 + e) * velAlongNormal / 2;
              // Anti-sticking tangential kick
              const tx = -ny, ty = nx;
              const kick = (Math.random() - 0.5) * CONFIG.PHYS.nudge * 0.5;

              a.vx -= impulse * nx - tx * kick;
              a.vy -= impulse * ny - ty * kick;
              b.vx += impulse * nx + tx * kick;
              b.vy += impulse * ny + ty * kick;

              limitVelocity(a);
              limitVelocity(b);
            }
          }
        }
      }
    }

    // ===== DATE FORMATTING =====
    function formatPosterDate(iso) {
      const d = new Date(iso + 'T12:00:00Z');
      const days = ['SUNDAY', 'MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY', 'SATURDAY'];
      const dd = String(d.getUTCDate()).padStart(2, '0');
      const mm = String(d.getUTCMonth() + 1).padStart(2, '0');
      return `${days[d.getUTCDay()]} ${dd}/${mm}`;
    }

    function toItDowShort(d) {
      return d.toLocaleString('it-IT', { weekday: 'short' }).toUpperCase();
    }

    function toMonShort(d) {
      return d.toLocaleString('it-IT', { month: 'short' }).toUpperCase();
    }

    function formatLongIt(iso) {
      const d = new Date(iso + 'T12:00:00');
      return d.toLocaleDateString('it-IT', { weekday: 'short', day: 'numeric', month: 'long', year: 'numeric' });
    }

    // ===== SHARE FUNCTIONS =====
    function buildShareText(ev) {
      const when = formatLongIt(ev.dateISO);
      const start = ev.start ? ` (start ${ev.start})` : '';
      const artists = [ev.headliner, ...(ev.guests || [])].filter(Boolean).join(', ');
      
      let lines = [];
      lines.push(`🎶 ${ev.title}`);
      if (artists) lines.push(`👤 ${artists}`);
      if (ev.genres?.length) lines.push(`🎧 ${ev.genres.join(' • ')}`);
      lines.push(`📍 17/19 Urban Bistrot • Roma`);
      lines.push(`🗓️ ${when}${start}`);
      lines.push('');
      lines.push(`Ti va?`);
      
      return lines.join('\n');
    }

    function waUrlFromEvent(ev) {
      return `https://wa.me/?text=${encodeURIComponent(buildShareText(ev))}`;
    }

    function tgUrlFromEvent(ev) {
      return `https://t.me/share/url?text=${encodeURIComponent(buildShareText(ev))}`;
    }

    function xUrlFromEvent(ev) {
      return `https://twitter.com/intent/tweet?text=${encodeURIComponent(buildShareText(ev))}`;
    }

    // ===== MENU DATA =====
    const menuData = [
      {
        badge: 'BREAKFAST',
        title: 'Colazione',
        isMainCategory: true,
        groups: [
          {
            title: 'Colazioni Special',
            collapsed: true,
            items: [
              { name: "Colazione all'Italiana", desc: "Tris di mieli italiani selezionati e frutta fresca; latticino con pan dolce/integrale e frutta secca; latte aromatizzato e caffè", price: "€10,00" },
              { name: "French Breakfast", desc: "Tè o infuso d'erbe; pan piastrato o pan brioche con burro; selezione di marmellate/composte/confetture", price: "€7,00" },
              { name: "Danish Breakfast", desc: "Spremuta; toast o pancake con sciroppo d'acero; caffè", price: "€7,00" },
              { name: "American Breakfast Salata", desc: "Bacon e uova strapazzate; pan piastrato, burro e confetture/composte; caffè americano", price: "€12,00" },
              { name: "American Breakfast Dolce", desc: "Cioccolata calda con panna; mini muffin assortiti o pasticceria da tè; caffè americano", price: "€10,00" },
              { name: "American Breakfast Piccante", desc: "Uova strapazzate alla paprika; pan piastrato e salame piccante; caffè americano", price: "€12,00" }
            ]
          },
          {
            title: 'Bakery',
            collapsed: true,
            items: [
              { name:"Pancake con sciroppo d'acero o d'agave", desc:"§§AUTO§§ Pancake con sciroppo d'acero o d'agave", price: "€4,00" },
              { name:"Pancake con crema, cioccolata o crema di pistacchio e panna", desc:"§§AUTO§§ Pancake con crema, cioccolata o crema di pistacchio e panna", price: "€5,00", photo: "/media/pancake-cioccolato-_2_.webp" },
              { name:"Pancake con confettura o marmellata e frutta fresca", desc:"§§AUTO§§ Pancake con confettura o marmellata e frutta fresca", price: "€5,00", photo: "/media/pancake%20frutta.webp" },
              { name:"Pasticceria da tè (al pz.)", desc:"§§AUTO§§ Pasticceria da tè (al pz.)", price: "€1,50" },
              { name:"Crostata di marmellata (al pz.)", desc:"§§AUTO§§ Crostata di marmellata (al pz.)", price: "€3,50" },
              { name:"Croissant semplice o farcito", desc:"§§AUTO§§ Croissant mignon semplice o farcito", price: "€1,50", photo: "/media/croassaint.webp" },
              { name:"Mini muffin classico o farcito", desc:"§§AUTO§§ Mini muffin classico o farcito", price: "€1,50" },
              { name:"Mini bombetta o mini ciambellina", desc:"§§AUTO§§ Mini bombetta o mini ciambellina", price: "€1,50" }
            ]
          },
          {
            title: 'Cioccolata calda',
            collapsed: true,
            items: [
              { name:"Classica oro", desc:"§§AUTO§§ Classica oro", price: "€4,50" },
              { name:"Caramello salato", desc:"§§AUTO§§ Caramello salato", price: "€4,50" },
              { name:"Gianduia", desc:"§§AUTO§§ Gianduia", price: "€4,50" },
              { name:"Rose e lamponi", desc:"§§AUTO§§ Rose e lamponi", price: "€4,50" },
              { name:"Arancia e cannella", desc:"§§AUTO§§ Arancia e cannella", price: "€4,50" },
              { name:"Fondente o bianca al pistacchio", desc:"§§AUTO§§ Fondente o bianca al pistacchio", price: "€4,50" },
              { name:"Menta", desc:"§§AUTO§§ Menta", price: "€4,50" }
            ]
          },
          {
            title: 'Caffetteria',
            collapsed: true,
            items: [
              { name:"Espresso", desc:"§§AUTO§§ Espresso", price: "€1,50" },
              { name:"Espresso decaffeinato", desc:"§§AUTO§§ Espresso decaffeinato", price: "€2,00" },
              { name:"Espresso americano", desc:"§§AUTO§§ Espresso americano", price: "€2,50" },
              { name:"Latte macchiato", desc:"§§AUTO§§ Latte macchiato", price: "€2,50" },
              { name:"Caffè latte", desc:"§§AUTO§§ Caffè latte", price: "€3,00" },
              { name:"Caffè o cappuccino spécial", desc:"§§AUTO§§ Caffè o cappuccino spécial", price: "€4,00" },
              { name:"Cappuccino", desc:"§§AUTO§§ Cappuccino", price: "€2,00" },
              { name:"Cappuccino vegetale di soya", desc:"§§AUTO§§ Cappuccino vegetale di soya", price: "€3,00" },
              { name:"Cappuccino senza lattosio", desc:"§§AUTO§§ Cappuccino senza lattosio", price: "€3,00" },
              { name:"Orzo (piccolo / grande)", desc:"§§AUTO§§ Orzo (piccolo / grande)", price: "€2,00 / €2,50" },
              { name:"Ginseng (piccolo / grande)", desc:"§§AUTO§§ Ginseng (piccolo / grande)", price: "€2,00 / €2,50" },
              { name: "Tè, rooibos o infuso d'erbe", price: "€4,00" }
            ]
          },
          {
            title: 'Succhi & Frutta',
            collapsed: true,
            items: [
              { name:"Spremuta di agrumi", desc:"§§AUTO§§ Spremuta di agrumi", price: "€4,00" },
              { name:"Centrifugato", desc:"§§AUTO§§ Centrifugato", price: "€5,00" },
              { name:"Macedonia o tagliata di frutta fresca", desc:"§§AUTO§§ Macedonia o tagliata di frutta fresca", price: "€6,00" },
              { name:"Granita", desc:"§§AUTO§§ Granita", price: "€6,00" },
              { name:"Milkshake", desc:"§§AUTO§§ Milkshake", price: "€4,00" }
            ]
          }
        ]
      },
      {
        badge: 'KITCHEN',
        title: 'La nostra cucina',
        isMainCategory: true,
        groups: [
          {
            title: 'Primi Piatti',
            collapsed: true,
            items: [
              { name:"Lasagna alla Bolognese", desc:"Lasagna alla Bolognese con ragù", price: "€10", photo: "/media/lasagna%20bolognese.webp" },
              { name:"Lasagna Vegetariana", desc:"Lasagna Vegetariana con scamorza e zucchine", price: "€10", photo: "/media/lasagna%20vegetariana.webp"  },
              { name:"Lasagna proposta di stagione", desc:"§§AUTO§§ Lasagna proposta dello chef di stagione", price: "€10" },
              { name:"Parmigiana di Melanzane", desc:"§§AUTO§§ Parmigiana di Melanzane", price: "€10", photo: "/media/parmigiana%20di%20melanzane.webp" },
              { name:"Ravioloni al sentore di Pistacchio con Ragù Bianco", desc:"§§AUTO§§ Ravioloni al sentore di Pistacchio con Ragù Bianco", price: "€13", photo: "/media/ravioli-pistacchio-ragù-bianco.webp" },
              { name:"Margherite di carciofi su salsa cacio e pepe", desc:"§§AUTO§§ Ravioli di carciofi su salsa cacio e pepe", price: "€13" },
              { name:"Ravioli al ragù di agnello", desc:"§§AUTO§§ Ravioli al ragù di agnello", price: "€14" },
              { name:"Ravioli Cacio e Pepe", desc:"§§AUTO§§ Ravioli Cacio e Pepe", price: "€13", photo: "/media/reviolicacio1%20(1).webp" },
              { name:"Ravioli Pomodoro e Basilico", desc:"§§AUTO§§ Ravioli Pomodoro e Basilico", price: "€13", photo: "/media/ravioli%20pomodoro%20e%20basilico.webp" },
              { name:"Fuori menù", desc:"Cucina del giorno, chiedere allo staff le proposte del giorno", price: "€13" }
            ]
          },
          {
            title: 'Secondi Piatti',
            collapsed: true,
            items: [
              { name:"Pollo al Curry", desc:"§§AUTO§§ Pollo al Curry", price: "€9" },
              { name:"Pollo wok con verdure", desc:"§§AUTO§§ Pollo wok con verdure", price: "€14", photo: "/media/pollo-wok.webp" },
              { name:"Straccetti e rucola con scaglie di Grana Padano", desc:"§§AUTO§§ Straccetti e rucola con scaglie di Grana Padano", price: "€15", photo: "/media/straccetti%20rucola.webp"},
              { name:"Tagliata di Pollo alle Erbe", desc:"§§AUTO§§ Tagliata di Pollo alle Erbe", price: "€9" },
              { name:"Guancia di Manzo al Vino Rosso", desc:"§§AUTO§§ Guancia di Manzo al Vino Rosso", price: "€14" },
              { name:"Spezzatino alla Cacciatora", desc:"§§AUTO§§ Spezzatino alla Cacciatora", price: "€14" },
              { name:"Bocconcini alle Prugne", desc:"§§AUTO§§ Bocconcini alle Prugne", price: "€14", photo: "/media/bocconcini%20maiale%20con%20prugne.webp" },
              { name:"Polpette al Vino Bianco", desc:"§§AUTO§§ Polpette al Vino Bianco", price: "€10", photo: "/media/polpette%20al%20vino.webp"  },
              { name:"Polpette al Sugo", desc:"§§AUTO§§ Polpette al Sugo", price: "€10" },
              { name:"Polpette Cacio e Pepe", desc:"§§AUTO§§ Polpette Cacio e Pepe", price: "€10", photo: "/media/poplpettecacioepepe.webp" },
              { name:"Fuori menù", desc:"§§AUTO§§ Cucina del giorno, chiedere allo staff le proposte del giorno", price: "€13" }
            ]
          },
          {
            title: 'Contorni',
            collapsed: true,
            items: [
              { name:"Cicoria Ripassata", desc:"§§AUTO§§ Cicoria Ripassata", price: "€7", photo: "/media/cicoria%20ripassata.webp"  },
              { name:"Scarola alla Partenopea", desc:"§§AUTO§§ Scarola alla Partenopea", price: "€7", photo: "/media/scarolapartenopea.webp"  },
              { name:"Broccoli Siciliani Ripassati", desc:"§§AUTO§§ Broccoli Siciliani Ripassati", price: "€7", photo: "/media/broccoli%20siciliani%20ripassati.webp" },
              { name:"Patate al Forno", desc:"§§AUTO§§ Patate al Forno", price: "€6", photo:"/media/patate%20al%20forno.webp" },
              { name:"Verdure Grigliate", desc:"§§AUTO§§ Verdure Grigliate", price: "€6", photo:"/media/verdure%20grigliate.webp"  }
            ]
          },
          {
            title: 'Piatto Unico',
            collapsed: true,
            items: [
              { name:"Piatto Unico", desc:"Piatto Unico riso thai, brunoise di verdure, pollo al curry", price: "€12", photo : "/media/piatto%20unico%20pollo%20curry.webp" }
            ]
          },
          {
          title: 'Al piatto',
          collapsed: true,
          items: [
            { 
              name: "Millefoglie di pane carasau", 
              desc: "Con stracciatella, pomodorini confit e basilico", 
              price: "€10" ,
              photo: "/media/millefoglie%20carasau.webp"
            },
            { 
              name: "Hummus di ceci", 
              desc: "Con crostini e brunoise di verdure", 
              price: "€10" ,
              photo: "/media/hummus.webp"
            },
            { 
              name: "Caprese pugliese", 
              desc: "Con burrata, pomodorini e crumble di taralli", 
              price: "€10" ,
              photo: "/media/caprese.webp"
            },
            { 
              name: "Crostone con burrata e alici del Cantabrico", 
              desc: "§§AUTO§§ Crostone con burrata e alici del Cantabrico", 
              price: "€10" ,
              photo: "/media/crostone%20burrata.webp"
            }
          ]
        },
          {
            title: 'Insalate',
            collapsed: true,
            items: [
              { name: "Nordica", desc: "Salmone, avocado, mozzarella", price: "€10", photo: "/media/insalata%20nordica.webp"},
              { name: "Mista", desc: "Pomodoro, carote, cetriolo, finocchio", price: "€9" },
              { name: "Caesar", desc: "Pollo, salsa Caesar, crostini e grana", price: "€10" }
            ]
          },
            {
            title: 'Club Sandwiches',
            collapsed: true,
            items: [
              { name: "ClubSandwich + Patate", desc: "Scegli uno dei gusti che più preferisci, e affianco troverai una produzione di chips di nostra produzione con salse incluse", price: "€12,00", photo: "/media/Clubsandwichpatate.webp" },
              { name: "Classic Club", desc: "Prosciutto e formaggio, insalata con pomodoro e pancetta", price: "€8,00", photo: "/media/Club%20Sandwich%20Cotto.webp" },
              { name: "Tonno Club", desc: "Insalata di tonno con radicchio, uovo sodo, salsa tartara, insalata e pomodoro", price: "€8,00", photo: "/media/Club%20Sandwich%20tonno.webp" },
              { name: "Salmone Club", desc: "Salmone affumicato, Philadelphia, uovo sodo, insalata e pomodoro", price: "€9,00", photo: "/media/Club%20Sandwich%20salmone.webp" },
              { name: "Hummus Club", desc: "Hummus di nostra produzione, Melanzane, Zucchine", price: "€9,00", photo: "/media/Club%20Sandwich%20hummus.webp" },
              { name: "Pollo Club", desc: "Insalata di pollo, salsa bernese, pomodoro, peperoni grigliati", price: "€9,00", photo: "/media/Club%20Sandwich%20Pollo.webp" }
            ]
          },
          {
            title: 'Taglieri & Focacce',
            collapsed: true,
            items: [
              { name: "La nostra selezione", desc: "Tagliere con selezione di affettati e formaggi", price: "€25", photo:"/media/grantagliere.webp" },
              { name: "Tagliere Nostrano", desc: "Prosciutto crudo stagionato e bufala", price: "€12", photo: "/media/tagliere%20nostrano.webp" },
              { name: "Focaccia Bianca", desc: "Con olio e rosmarino", price: "€5", photo:"/media/focaccia%20bianca%20(1).webp" }
            ]
          },
          {
            title: 'Dolci al piatto',
            collapsed: true,
            items: [
              { name: "Tiramisù", desc: "Classica crema al tiramisù, con pan di spagna bagnato al caffè", price: "€7", photo:"/media/tiramisu%20con%20savoiardi.webp" },
              { name: "Cheesecake", desc: "Gustoso semifreddo dalle note inconfondibili di crema ai formaggi, con glassa ai frutti di bosco", price: "€7", photo: "/media/cheesecake%20ai%20frutti%20di%20bosco1.webp" },
              { name: "Mia", desc: "Fondo di crumble al cacao e bisquit alla nocciola con ganache montata e pralinato di nocciole della Tuscia", price: "€7", photo:"/media/mia1.webp" },
              { name: "Choconut", desc: "Un croccante biscotto al cacao e nocciola, due strati di mousse al cioccolato e nocciola, ricoperte da glassa alla gianduia", price: "€7", photo: "/media/choconut1.webp" },
              { name: "Granita di caffè", desc: "Una fresca granita di caffè con panna", price: "€6", photo:"/media/granita%20al%20caffè.webp" },
            ]
          },
        ]
      },
      {
        badge: 'DRINKS',
        title: 'Drinks',
        isMainCategory: true,
        groups: [
       // ——— VINI ———
{ title:'Vini Bianchi', collapsed: true, items:[
  { name:"Pecorino Bio Cascina del Colle", desc:"Vitigno: Pecorino • Zona: Abruzzo • 13%", price:"Calice €6,00 • Bottiglia €22,00" },
  { name:"Ribolla Gialla Collio Pighin", desc:"Vitigno: Ribolla Gialla • Zona: Friuli • 13%", price:"Calice €7,00 • Bottiglia €24,00" },
  { name:"Riesling Fallwind St.Michael-Eppan", desc:"Vitigno: Riesling • Zona: Alto Adige • 13,5%", price:"Solo bottiglia €26,00" },
  { name:"Gewürztraminer Aldeno", desc:"Vitigno: Gewürztraminer • Zona: Trentino • 12,5%", price:"Solo bottiglia €23,00" },
  { name:"Sauvignon Alturis", desc:"Vitigno: Sauvignon • Zona: Friuli • 12,5%", price:"Calice €7,00 • Bottiglia €23,00" },
  { name:"Roero Arneis Bel Colle", desc:"Vitigno: Arneis • Zona: Piemonte (Roero) • ~13%", price:"Solo bottiglia €22,00" },
  { name:"Chardonnay Ducaminimo Cascina del Colle", desc:"Vitigno: Chardonnay • Zona: Abruzzo • 12,5%", price:"Calice €6,00 • Bottiglia €20,00" },
  { name:"Grillo Fatascià", desc:"Vitigno: Grillo • Zona: Sicilia • ~13%", price:"Calice €7,00 • Bottiglia €20,00" },
  { name:"Gelso Bianco Tenuta i Gelsi", desc:"Vitigno: Malvasia • Zona: Basilicata • 13%", price:"Calice €7,00 • Bottiglia €20,00" },
  { name:"12 e mezzo Malvasia Bianca Varvaglione", desc:"Vitigno: Malvasia Bianca • Zona: Puglia • 12,5%", price:"Calice €7,00 • Bottiglia €23,00" }
]},

{ title:'Vini Rosati', collapsed: true, items:[
  { name:"Pighin", desc:"Rosato ottenuto da uve di Refosco• Zona: Fiueli", price:"Calice €7,00 • Bottiglia €25,00" }
]},

{ title:'Vini Rossi', collapsed: true, items:[
  { name:"Primitivo di Manduria Sua Maestà Erario", desc:"Vitigno: Primitivo • Zona: Puglia • 15%", price:"Calice €7,00 • Bottiglia €22,00" },
  { name:"Pinot Nero Alturis", desc:"Vitigno: Pinot Nero • Zona: Friuli • 13%", price:"Calice €7,00 • Bottiglia €23,00" },
  { name:"Valpolicella Superiore Domìni Veneti", desc:"Corvina • Corvinone • Rondinella • Zona: Veneto • 13%", price:"Calice €8,00 • Bottiglia €24,00" },
  { name:"Morellino Mentore Mantellassi", desc:"Sangiovese (Morellino) con uvaggi • Zona: Toscana • 14%", price:"Calice €7,00 • Bottiglia €23,00" },
  { name:"Cabernet Sauvignon Alturis", desc:"Vitigno: Cabernet Sauvignon • Zona: Friuli • 13%", price:"Solo bottiglia €23,00" },
  { name:"Negroamaro Sua Maestà Erario", desc:"Vitigno: Negroamaro • Zona: Puglia • 15%", price:"Solo bottiglia €25,00" },
  { name:"Montepulciano Ducaminimo Cascina del Colle", desc:"Vitigno: Montepulciano • Zona: Abruzzo • 12,5%", price:"Calice €6,00 • Bottiglia €20,00" },
  { name:"Nero d’Avola Aprimonio Fatascià", desc:"Vitigno: Nero d’Avola • Zona: Sicilia • 12%", price:"Calice €6,00 • Bottiglia €23,00" },
  { name:"12 e mezzo Malvasia Nera Varvaglione", desc:"Vitigno: Malvasia Nera • Zona: Puglia • 12,5%", price:"Calice €6,00 • Bottiglia €23,00" }
]},

{ title:'Bollicine', collapsed: true, items:[
  { name:"Le Rosé Metodo Classico Barbatèrre", desc:"Pinot Nero • Emilia • 60 mesi sui lieviti • 12,5%", price:"Solo bottiglia €39,00" },
  { name:"Blanc de Blanc Metodo Classico Barbatèrre", desc:"Sauvignon Blanc • Emilia • 30 mesi sui lieviti • 12,5%", price:"Solo bottiglia €34,00" },
  { name:"Blanc de Noir Metodo Classico Barbatèrre", desc:"Pinot Nero • Emilia • 30 mesi sui lieviti • 12,5%", price:"Solo bottiglia €34,00" },
  { name:"Bacio della Luna Metodo Classico Cantine di Ora", desc:"Chardonnay, Pinot Nero • Trentino • 11%", price:"Calice €8,00 • Bottiglia €28,00" },
  { name:"Rosita Franciacorta Ugo Vezzoli", desc:"Pinot Nero • Lombardia • 12,5%", price:"Solo bottiglia €34,00" },
  { name:"Brut Franciacorta Ugo Vezzoli", desc:"Chardonnay, Pinot Nero • Lombardia • 12,5%", price:"Solo bottiglia €35,00" },
  { name:"Satèn Franciacorta Ugo Vezzoli", desc:"Chardonnay • Lombardia • 12,5%", price:"Solo bottiglia €38,00" },
  { name:"Prosecco Millesimato Extra Dry", desc:"Glera • Veneto • 11%", price:"Calice €5,00 • Bottiglia €25,00" }
]},
// --- GIN & TONIC ---
{
  title:'Gin Tonic',
  collapsed: true,
  items:[
    { name:"Bombay Sapphire", desc:"Gin tonic con Bombay Sapphire", price:"€10,00" },
    { name:"Nordés", desc:"Gin tonic con Nordés", price:"€10,00" },
    { name:"Plymouth", desc:"Gin tonic con Plymouth", price:"€10,00" },
    { name:"Tanqueray", desc:"Gin tonic con Tanqueray", price:"€10,00" },
    { name:"Etsu", desc:"Gin tonic con Etsu", price:"€12,00" },
    { name:"Hendrick’s", desc:"Gin tonic con Hendrick’s", price:"€12,00" },
    { name:"Gin Mare", desc:"Gin tonic con Gin Mare", price:"€12,00" },
    { name:"Monkey 47", desc:"Gin tonic con Monkey 47", price:"€12,00" },
    { name:"No.3 London Dry", desc:"Gin tonic con No.3 London Dry", price:"€12,00" },
    { name:"The Botanist", desc:"Gin tonic con The Botanist", price:"€12,00" }
  ]
},

// --- RUM / RHUM (60 ml) ---
{
  title:'Rum • 60 ml',
  collapsed: true,
  items:[
    { name:"Barceló Imperial", desc:"Rum 60 ml — liscio o on the rocks", price:"€12,00" },
    { name:"Captain Morgan", desc:"Rum 60 ml — liscio o on the rocks", price:"€8,00" },
    { name:"Diplomático", desc:"Rum 60 ml — liscio o on the rocks", price:"€10,00" },
    { name:"Don Papa Baroko", desc:"Rum 60 ml — liscio o on the rocks", price:"€10,00" },
    { name:"Kraken", desc:"Rum 60 ml — liscio o on the rocks", price:"€8,00" },
    { name:"Rhum J.M XO", desc:"Rhum 60 ml — liscio o on the rocks", price:"€10,00" }
  ]
},

// --- WHISKY (60 ml) ---
{
  title:'Whisky • 60 ml',
  collapsed: true,
  items:[
    { name:"Bulleit Rye", desc:"Whisky 60 ml — liscio o on the rocks", price:"€10,00" },
    { name:"Jameson IPA Edition", desc:"Whisky 60 ml — liscio o on the rocks", price:"€10,00" },
    { name:"Jack Daniel’s Honey", desc:"Whisky 60 ml — liscio o on the rocks", price:"€10,00" },
    { name:"Jameson", desc:"Whisky 60 ml — liscio o on the rocks", price:"€8,00" },
    { name:"Jim Beam Bourbon", desc:"Whisky 60 ml — liscio o on the rocks", price:"€8,00" },
    { name:"Maker’s Mark", desc:"Whisky 60 ml — liscio o on the rocks", price:"€12,00" },
    { name:"Nikka", desc:"Whisky 60 ml — liscio o on the rocks", price:"€15,00" },
    { name:"Talisker Skye", desc:"Whisky 60 ml — liscio o on the rocks", price:"€12,00" },
    { name:"Yukisato Blended", desc:"Whisky 60 ml — liscio o on the rocks", price:"€14,00" }
  ]
},

// --- AMARI ---
{
  title:'Amari',
  collapsed: true,
  items:[
    { name:"Amaro del Capo", desc:"Digestivo", price:"€4,00" },
    { name:"Della Rocca Arancio", desc:"Liquore all’arancia", price:"€5,00" },
    { name:"Della Rocca Erbe", desc:"Amaro alle erbe", price:"€5,00" },
    { name:"Dente di Leone", desc:"Liquore al tarassaco", price:"€5,00" },
    { name:"Fernet", desc:"Digestivo", price:"€4,00" },
    { name:"Jägermeister", desc:"Erbe officinali", price:"€4,00" },
    { name:"Jefferson", desc:"Amaro calabrese", price:"€5,00" },
    { name:"Montenegro", desc:"Amaro tradizionale", price:"€4,00" },
    { name:"Kaciuto", desc:"Amaro", price:"€5,00" }
  ]
},
{
  title:'PreDinner Spritz',
  collapsed: true,
  items:[
    { name:"Aperol Spritz", desc:"Prosecco; Aperol; soda", price:"€8,00" },
    { name:"Campari Spritz", desc:"Prosecco; Campari; soda", price:"€8,00" },
    { name:"Hugo Spritz", desc:"Prosecco; liquore ai fiori di sambuco; menta", price:"€9,00" },
    { name:"Passoã Spritz", desc:"Liquore al passion fruit (Passoã); prosecco; sciroppo al passion fruit", price:"€9,00" },
    { name:"Little Spritz", desc:"Liquore di Bergamotto 'Italicus'; sciroppo al peperoncino; home made soda", price:"€9,00" },
    { name:"Green Spritz", desc:"Prosecco; liquore Galliano; succo di ananas; liquore al melone, soda", price:"€9,00" },
    { name:"Violetta Spritz", desc:"Liquore alla violetta; succo fresco di lime; succo di mela; prosecco", price:"€9,00" },
    { name:"Liquirizia Spritz", desc:"Prosecco; liquore alla liquiriza; soda", price:"€9,00" },
    { name:"Rabarbaro Spritz", desc:"Prosecco; liquore al rabarbaro; sciroppo di fragola", price:"€9,00" },
    { name:"Rose Spritz", desc:"Prosecco; liquore alle rose; succo di mela; soda", price:"€9,00" },
    { name:"Sorrento Spritz", desc:"Prosecco; limoncello di Sorrento; sciroppo di granatina", price:"€9,00" },
    { name:"Orange Spritz", desc:"Aperitivo Gamundi; liquore all’arancia; prosecco; succo di arancia", price:"€9,00" },
]},
{
  title: "Twist",
  collapsed: true,
  items: [
    { name: "Don Negroni", desc: "Rum Don Papa; Vermouth Cocchi; Bitter Gamondi; vaporizzazione al bourbon", price: "€10,00" },
    { name: "Clovers in the Club", desc: "Gin; sciroppo alla fragola; succo fresco di limone; sciroppo di zucchero; liquore al lychee", price: "€10,00" },
    { name: "Coffee Kill", desc: "Bourbon; vermouth rosso; bitter Gamondi; infusione idroalcolica al caffè; miele; bitter al cioccolato", price: "€10,00" },
    { name: "Coco Loco", desc: "Rum bianco Bacardi Carta Blanca; tequila silver Jose Cuervo; vodka; succo fresco di lime; purea di cocco", price: "€10,00" },
    { name: "Pop-Corn", desc: "Whisky Maker’s Mark; succo fresco di limone; albume pastorizzato; sciroppo di zucchero al pop-corn", price: "€10,00" }
  ]
},


{
  title: "Signature",
  collapsed: true,
  items: [
    { name: "Berry", desc: "Vodka; liquore alle more; sciroppo alla fragola; succo fresco di limone; ginger beer", price: "€12,00" },
    { name: "Vod Cheri", desc: "Vodka; cherry; sciroppo alla cannella; succo fresco di limone; sciroppo di fragola", price: "€12,00" },
    { name: "Caramba", desc: "Rum Don Papa; cachaça; rum scuro Pampero; succo fresco di lime; sciroppo al passion fruit; ginger beer", price: "€12,00" },
    { name: "Sunset Dream", desc: "Tequila Silver Jose Cuervo; succo d’arancia; succo fresco di limone; liquore Galliano; liquore al passion fruit Passoa; sciroppo di zucchero", price: "€12,00" },
    { name: "17/19", desc: "Rum Captain Morgan Dark; rum gold; succo fresco di lime; succo di mela; crema marshmallow home made con albume; sciroppo di granatina", price: "€12,00" },
    { name: "Flower", desc: "Gin; bitter Gamondi; liquore ai fiori di sambuco; succo fresco di lime; sciroppo di zucchero; albume pastorizzato", price: "€12,00" },
    { name: "Aztec Soul", desc: "Mezcal; liquore maraschino; liquore al melone; succo fresco di lime; succo di ananas", price: "€12,00" }
  ]
},

{
  title:'Analcolici',
  collapsed: true,
  items:[
    { name:"Raspberry Orange", desc:"Succo d’arancia; sciroppo di granatina; succo fresco di lime; sciroppo di zucchero; sciroppo al lampone", price:"€8,00" },
    { name:"Un Colpo di Cooler", desc:"3/4 spicchi di lime; 2/3 fette d’arancia; zucchero (mix sugar); ginger beer", price:"€8,00" },
    { name:"Tropical Breakfast", desc:"Marmellata di albicocche; succo di ananas; mix sour; yogurt greco", price:"€8,00" },
    { name:"Baby Margarita", desc:"Sciroppo d’agave; succo fresco di lime; sale; succo di pompelmo rosa", price:"€8,00" },
    { name:"Nel Bosco", desc:"Succo di mirtillo; succo cranberry; sciroppo di fragola; succo fresco di lime", price:"€8,00" },
    { name:"Sunny fruit", desc:"Succo di ananas; succo di arancia; succo di limone; sciroppo di granatina;", price:"€8,00" },
  ]
},
]
      },
    ];

    function renderMenu() {
      const wrap = document.getElementById('menuAccordions');
      wrap.innerHTML = '';

      menuData.forEach(cat => {
        // Main category accordion
        const details = document.createElement('details');
        details.className = 'menu-acc reveal';
        
        const sum = document.createElement('summary');
        sum.className = 'menu-sum';
        sum.innerHTML = `<span class="badge">${cat.badge}</span><h3>${cat.title}</h3><svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>`;
        details.appendChild(sum);

        const body = document.createElement('div');
        body.className = 'menu-body';

        // Handle direct items (for categories without groups)
        if (cat.items) {
          cat.items.forEach(it => {
            const row = document.createElement('div');
            row.className = 'menu-item';
            row.innerHTML = `
              <div class="mi-left"><span class="notranslate">${it.name}</span> <span class="meta">${it.desc || ""}</span></div>
              <div class="mi-right">
                <div class="price">${it.price || ""}</div>
                ${it.photo ? `<button type="button" class="photo-btn" data-photo="${it.photo}" data-caption="${it.name}"><svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg> Foto</button>` : ""}
              </div>
            `;
            body.appendChild(row);
          });
        }

        // Handle groups (for categories with subcategories)
        if (cat.groups) {
          cat.groups.forEach(gr => {
            if (gr.collapsed) {
              // Create sub-accordion for collapsed groups
              const subDetails = document.createElement('details');
              subDetails.className = 'menu-acc';
              subDetails.style.margin = '8px 0';
              subDetails.style.fontSize = '0.95em';

              const subSum = document.createElement('summary');
              subSum.className = 'menu-sum';
              subSum.innerHTML = `<span class="group-title">${gr.title}</span><svg class="chev" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>`;
              subDetails.appendChild(subSum);

              const subBody = document.createElement('div');
              subBody.className = 'menu-body';

              gr.items.forEach(it => {
                const row = document.createElement('div');
                row.className = 'menu-item';
                row.innerHTML = `
                  <div class="mi-left"><span class="notranslate">${it.name}</span> <span class="meta">${it.desc || ""}</span></div>
                  <div class="mi-right">
                    <div class="price">${it.price || ""}</div>
                    ${it.photo ? `<button type="button" class="photo-btn" data-photo="${it.photo}" data-caption="${it.name}"><svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg> Foto</button>` : ""}
                  </div>
                `;
                subBody.appendChild(row);
              });

              subDetails.appendChild(subBody);
              body.appendChild(subDetails);
            } else {
              // Regular group title + items
              const gt = document.createElement('div');
              gt.className = 'group-title';
              gt.textContent = gr.title;
              body.appendChild(gt);

              gr.items.forEach(it => {
                const row = document.createElement('div');
                row.className = 'menu-item';
                row.innerHTML = `
                  <div class="mi-left"><span class="notranslate">${it.name}</span> <span class="meta">${it.desc || ""}</span></div>
                  <div class="mi-right">
                    <div class="price">${it.price || ""}</div>
                    ${it.photo ? `<button type="button" class="photo-btn" data-photo="${it.photo}" data-caption="${it.name}"><svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg> Foto</button>` : ""}
                  </div>
                `;
                body.appendChild(row);
              });
            }
          });
        }

        details.appendChild(body);
        wrap.appendChild(details);
      });

      document.querySelectorAll('.reveal:not(.active)').forEach(el => io.observe(el));
      if (window.afterMenuRender) window.afterMenuRender();
    }

    // ===== EVENTS =====
    const events = [
      { dateISO: '2025-10-24', booking: 'soon', venue: '17/19 URBAN BISTROT', title: 'XXX', genres: ['XXX'], start: 'XX:XX', curatedBy: 'XXX', headliner: 'XXX', guests: ['XXX'], sponsors: [{ text: 'XXX' }] },
      { dateISO: '2025-10-25', booking: 'soon', venue: '17/19 URBAN BISTROT', title: 'XXX', genres: ['XXX'], start: 'XX:XX', curatedBy: 'XXX', headliner: 'XXX', guests: ['XXX'], sponsors: [{ text: 'XXX' }] },
      { dateISO: '2025-10-26', booking: 'soon', venue: '17/19 URBAN BISTROT', title: 'XXX', genres: ['XXX'], start: 'XX:XX', curatedBy: 'XXX', headliner: 'XXX', guests: ['XXX'], sponsors: [{ text: 'XXX' }] },
    ];

    function pickNextEvent() {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const upcoming = events.filter(e => !isNaN(new Date(e.dateISO)) && new Date(e.dateISO) >= today)
                           .sort((a, b) => new Date(a.dateISO) - new Date(b.dateISO));
      
      return upcoming[0] || events.sort((a, b) => new Date(a.dateISO) - new Date(b.dateISO))[0];
    }

    function eventId(ev) {
      return ev.dateISO + '::' + slug(ev.title);
    }

    function makeNameChip(name, role) {
      if (!name) return null;
      
      const chip = document.createElement('span');
      chip.className = 'name-chip';
      chip.innerHTML = `${role === 'headliner' ? '<span class="dot" style="width:8px;height:8px;border-radius:3px;background:var(--fg)"></span>' : ''}${name}`;
      return chip;
    }

    function makeSChip(txt) {
      const s = document.createElement('span');
      s.className = 's-chip';
      s.textContent = txt;
      return s;
    }

    let eventsExpanded = false;

    function renderEvents() {
      const list = document.getElementById('eventsList');
      if (!list) return;
      
      list.innerHTML = '';
      
      const sorted = [...events].sort((a, b) => new Date(a.dateISO) - new Date(b.dateISO)).slice(0, 7);
      const toShow = eventsExpanded ? sorted : sorted.slice(0, 3);
      
      toShow.forEach(ev => {
        const d = new Date(ev.dateISO + 'T12:00:00');
        const day = String(d.getUTCDate()).padStart(2, '0');
        const mon = toMonShort(d);
        const dow = toItDowShort(d).slice(0, 3).toUpperCase();
        const eid = eventId(ev);

        const el = document.createElement('div');
        el.className = 'event';
        el.dataset.eid = eid;

        // Title
        const title = document.createElement('div');
        title.className = 'event__title';
        title.innerHTML = `<strong>${ev.title}</strong>`;
        el.appendChild(title);

        // Top bar
        const top = document.createElement('div');
        top.className = 'event__top';

        const dateBox = document.createElement('div');
        dateBox.className = 'event__date';
        dateBox.innerHTML = `<div class="event__dow">${dow}</div><div class="event__day">${day} ${mon}</div>`;
        top.appendChild(dateBox);

        // CTA prenota (per-evento)
        let cta;
        if (ev.booking === 'open') {
          cta = document.createElement('a');
          cta.className = 'pill pill--ghost event__cta';
          cta.href = `https://wa.me/393298252092?text=${encodeURIComponent('Ciao 17/19 Urban Bistrot, vorrei prenotare per: ' + ev.title + ' • ' + formatLongIt(ev.dateISO))}`;
          cta.target = '_blank';
          cta.rel = 'noopener';
          cta.textContent = 'Prenota';
        } else {
          cta = document.createElement('span');
          cta.className = 'pill pill--ghost pill--disabled event__cta';
          cta.textContent = ev.booking === 'soon' ? 'Coming Soon' : 'Prenotazioni chiuse';
        }
        top.appendChild(cta);
        el.appendChild(top);

        // Info row
        const info = document.createElement('div');
        info.className = 'event__info';
        const parts = [ev.start ? `Start ${ev.start}` : null, ...(ev.genres || [])].filter(Boolean);
        info.innerHTML = parts.map(t => `<span>${t}</span>`).join('');
        el.appendChild(info);

        // Names
        const namesRow = document.createElement('div');
        namesRow.className = 'event__names';
        const head = makeNameChip(ev.headliner, 'headliner');
        if (head) namesRow.appendChild(head);
        
        (ev.guests || []).forEach(g => {
          const ch = makeNameChip(g, 'guest');
          if (ch) namesRow.appendChild(ch);
        });
        el.appendChild(namesRow);

        // (opz.) Sponsor in card
        if (CONFIG.SHOW_SPONSORS_IN_CARD && ev.sponsors?.length) {
          const srow = document.createElement('div');
          srow.className = 'event__sponsors';
          ev.sponsors.forEach(s => s.text && srow.appendChild(makeSChip(s.text)));
          el.appendChild(srow);
          el.classList.add('event--show-sponsors');
        }

        // Upvote badge (aggregato)
        const vb = document.createElement('div');
        vb.className = 'vote-badge';
        vb.innerHTML = `${SVG.up}<strong class="n">${Store.getFlameCount(eid)}</strong>`;
        el.appendChild(vb);
        
        if (Store.getMyFlame(eid)) el.classList.add('event--voted');

        // Actions row (Condividi)
        const actions = document.createElement('div');
        actions.className = 'event__actions';
        
        const shareBtn = document.createElement('button');
        shareBtn.className = 'pill pill--ghost';
        shareBtn.innerHTML = `${SVG.share}<span>Condividi</span>`;
        shareBtn.addEventListener('click', (e) => openShare(el, ev, e.currentTarget));
        actions.appendChild(shareBtn);
        el.appendChild(actions);

        // Double-tap sulla card (toggle flame)
        makeDoubleTap(el, () => {
          const my = Store.toggleFlame({ eid, ctx: { eid, title: ev.title, dateISO: ev.dateISO } });
          el.classList.toggle('event--voted', !!my);
          vb.querySelector('.n').textContent = Store.getFlameCount(eid);
          
          if (my) {
            el.classList.remove('event--burst');
            void el.offsetWidth; // Reflow per riarmare l'animazione
            el.classList.add('event--burst');
          }
        });

        list.appendChild(el);
      });

      const btn = document.getElementById('eventsMoreBtn');
      if (sorted.length <= 3) {
        btn.style.display = 'none';
      } else {
        btn.style.display = 'inline-flex';
        btn.textContent = eventsExpanded ? 'Mostra meno' : 'Mostra altri';
      }
    }

    function openShare(cardEl, ev, anchor) {
      const text = buildShareText(ev);
      const url = location.href.split('#')[0] + '#events';
      
      if (navigator.share) {
        navigator.share({ title: `17/19 • ${ev.title}`, text, url }).catch(() => {});
        return;
      }
      
      let pop = cardEl.querySelector('.share-pop');
      if (!pop) {
        pop = document.createElement('div');
        pop.className = 'share-pop';
        pop.innerHTML = `
          <a href="${waUrlFromEvent(ev)}" target="_blank" rel="noopener">WhatsApp</a>
          <a href="${tgUrlFromEvent(ev)}" target="_blank" rel="noopener">Telegram</a>
          <a href="${xUrlFromEvent(ev)}" target="_blank" rel="noopener">X</a>
          <button type="button" data-cpy>Copia</button>
        `;
        cardEl.appendChild(pop);
        
        pop.querySelector('[data-cpy]').addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(text + '\n' + url);
          } catch (e) {}
          pop.style.display = 'none';
        });
      }
      
      const r = anchor.getBoundingClientRect();
      const pr = cardEl.getBoundingClientRect();
      pop.style.left = (r.left - pr.left) + 'px';
      pop.style.top = (r.bottom - pr.top + 6) + 'px';
      pop.style.display = 'grid';
      
      document.addEventListener('click', function close(e) {
        if (!pop.contains(e.target) && e.target !== anchor) {
          pop.style.display = 'none';
          document.removeEventListener('click', close, true);
        }
      }, true);
    }

    function updateEventCountsFromStore() {
      $$('#eventsList .event').forEach(el => {
        const eid = el.dataset.eid;
        el.querySelector('.vote-badge .n').textContent = Store.getFlameCount(eid);
        el.classList.toggle('event--voted', !!Store.getMyFlame(eid));
      });
    }

    function updatePosterChipCounts() {
      if (!posterCanvas) return;
      
      bouncers.forEach(b => {
        const name = b.el.dataset.name;
        const cnt = b.el.querySelector('.rc .n');
        if (cnt) cnt.textContent = Store.getRocketsAgg(name);
      });
    }

    // ===== INITIALIZATION =====
    function bindPosterFromEvent(ev) {
      const names = [ev.headliner].concat(ev.guests || []).filter(Boolean).map(s => s.toUpperCase());
      
      posterData.venue = (ev.venue || '17/19 URBAN BISTROT').toUpperCase();
      posterData.series = (ev.title || '').toUpperCase();
      posterData.date = formatPosterDate(ev.dateISO);
      posterData.tagline = (ev.genres && ev.genres.length ? ev.genres.join(' • ') : 'TECHNO • ELECTRO • VINYL').toUpperCase();
      posterData.curatedBy = ('Curated by ' + (ev.curatedBy || 'Resident DJs')).toUpperCase();
      posterData.logos = (ev.sponsors || []).map(s => ({ text: (s.text || '').toUpperCase() }));
      
      currentPosterEventCtx = { eid: eventId(ev), title: ev.title, dateISO: ev.dateISO };
      
      setPosterTexts(posterData);
      
      if (CONFIG.SHOW_POSTER) {
        initBouncers(names.slice(0, 3)); // fino a 3 nomi nel poster
        updatePosterChipCounts();
      }
    }

    function setupHeroDisplay() {
      const posterFrame = document.getElementById('posterFrame');
      const liveCarousel = document.getElementById('liveCarousel');
      
      if (CONFIG.SHOW_POSTER) {
        posterFrame.style.display = '';
        liveCarousel.style.display = 'none';
      } else {
        posterFrame.style.display = 'none';
        liveCarousel.style.display = '';
        setupLiveCarousel();
      }
    }

    function renderEverything() {
      renderMenu();
      renderEvents();
      bindPosterFromEvent(pickNextEvent());
      setupHeroDisplay();
      
      $('#eventsMoreBtn').addEventListener('click', () => {
        eventsExpanded = !eventsExpanded;
        renderEvents();
        updateEventCountsFromStore();
      });
    }

    renderEverything();

    // ===== PHOTO MODAL =====
    (function() {
      const modal = document.getElementById('photoModal');
      const modalImg = document.getElementById('modalPhoto');
      const modalCaption = document.getElementById('modalCaption');
      const modalClose = modal.querySelector('.modal__close');
      
      function openModal(src, caption) {
        // Show modal
        modal.classList.add('show');
        modal.setAttribute('aria-hidden', 'false');
        document.documentElement.classList.add('modal-open');
        document.body.classList.add('modal-open');
        
        // Set image and caption
        modalImg.src = src;
        modalImg.alt = caption || 'Foto prodotto';
        modalCaption.textContent = caption || '';
        
        // Focus management
        modalClose.focus();
      }
      
      function closeModal() {
        modal.classList.remove('show');
        modal.setAttribute('aria-hidden', 'true');
        document.documentElement.classList.remove('modal-open');
        document.body.classList.remove('modal-open');
        
        // Reset content
        modalImg.src = '';
        modalCaption.textContent = '';
      }
      
      // Event listeners
      document.addEventListener('click', function(e) {
        // Open from photo button
        const btn = e.target.closest('.photo-btn');
        if (btn) {
          e.preventDefault();
          const src = btn.getAttribute('data-photo');
          const caption = btn.getAttribute('data-caption');
          if (src) openModal(src, caption);
          return;
        }
        
        // Close if clicking the X or outside the modal content
        if (e.target === modalClose || (e.target === modal && !modal.querySelector('.modal__body').contains(e.target))) {
          e.preventDefault();
          closeModal();
          return;
        }
      });
      
      // ESC key to close
      window.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.classList.contains('show')) {
          closeModal();
        }
      });
      
      // Close button
      modalClose.addEventListener('click', closeModal);
    })();

    // ===== SMOOTH SCROLL =====
    (function() {
      function scrollWithOffset(targetId) {
        const el = document.querySelector(targetId);
        if (!el) return;
        
        const headerH = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-h')) || 64;
        const y = el.getBoundingClientRect().top + window.pageYOffset - (headerH + 8);
        
        window.scrollTo({ top: y, behavior: 'smooth' });
      }
      
      document.querySelectorAll('a[href^="#"]').forEach(a => {
        a.addEventListener('click', function(e) {
          const href = this.getAttribute('href');
          if (!href || href.length < 2) return;
          
          const id = href.slice(1);
          const tgt = document.getElementById(id);
          
          if (tgt) {
            e.preventDefault();
            scrollWithOffset('#' + id);
          }
        });
      });
    })();

    // ===== DETAILS ANIMATION =====
    (function() {
      function animateDetails(el) {
        if (!el) return;
        
        el.addEventListener('toggle', () => {
          const body = el.querySelector('.menu-body');
          if (!body) return;
          
          body.style.overflow = 'hidden';
          const start = el.open ? 0 : body.scrollHeight;
          const end = el.open ? body.scrollHeight : 0;
          const duration = 220;
          const startTime = performance.now();
          
          function tick(now) {
            const t = Math.min(1, (now - startTime) / duration);
            const eased = t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t; // easeInOutQuad
            const h = start + (end - start) * eased;
            
            body.style.maxHeight = h + 'px';
            
            if (t < 1) {
              requestAnimationFrame(tick);
            } else if (el.open) {
              body.style.maxHeight = '';
              body.style.overflow = 'visible';
            } else {
              body.style.maxHeight = '';
              body.style.overflow = 'hidden';
            }
          }
          
          requestAnimationFrame(tick);
        });
      }
      
      document.querySelectorAll('details.menu-acc').forEach(animateDetails);
      
      // Also wrap newly rendered after renderMenu()
      window.afterMenuRender = function() {
        document.querySelectorAll('details.menu-acc').forEach(animateDetails);
      };
    })();

    // ===== VIEWPORT UNIT FIX =====
    (function() {
      function setVH() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
      }
      
      setVH();
      window.addEventListener('resize', setVH, { passive: true });
      window.addEventListener('orientationchange', setVH);
      
      // Recalculate for mobile URL bar
      let timeout;
      window.addEventListener('scroll', function() {
        clearTimeout(timeout);
        timeout = setTimeout(setVH, 120);
      }, { passive: true });
    })();

    // Global loader helpers
    window.Loader = {
      el: null,
      ensure() {
        if (!this.el) {
          this.el = document.getElementById('globalLoader');
        }
        return this.el;
      },
      show() {
        const el = this.ensure();
        if (el) {
          el.style.display = 'grid';
        }
      },
      hide() {
        const el = this.ensure();
        if (el) {
          el.style.display = 'none';
        }
      }
    };
  </script>




<script>
(function() {
  var MARK = '§§AUTO§§';
  function getCookie(name) {
    const m = document.cookie.match(new RegExp('(?:^|; )' + name.replace(/([.$?*|{}()\[\\/\+^])/g, '\$1') + '=([^;]*)'));
    return m ? decodeURIComponent(m[1]) : '';
  }
  function currentLang() {
    const goog = getCookie('googtrans'); // e.g. "/it/en" or "/auto/it"
    if (goog && goog.indexOf('/') !== -1) {
      const parts = goog.split('/').filter(Boolean);
      if (parts.length) return parts[parts.length - 1].toLowerCase();
    }
    const l = (document.documentElement.getAttribute('lang') || navigator.language || 'it').toLowerCase();
    return l.split('-')[0];
  }
  function applyLangClass() {
    const isIt = currentLang() === 'it';
    document.documentElement.classList.toggle('lang-it', isIt);
    // Also directly hide/show auto descs regardless of CSS
    document.querySelectorAll('.desc--auto').forEach(el => {
      el.style.display = isIt ? 'none' : '';
      el.style.visibility = isIt ? 'hidden' : '';
    });
  }
  // Convert any text nodes containing the marker into <span class="desc--auto"> and strip the marker
  function transformMarkers(root) {
    const walker = document.createTreeWalker(root || document.body, NodeFilter.SHOW_TEXT, null);
    const nodes = [];
    while (walker.nextNode()) {
      const n = walker.currentNode;
      if (n.nodeValue && n.nodeValue.indexOf(MARK) !== -1) nodes.push(n);
    }
    nodes.forEach(node => {
      const txt = node.nodeValue;
      const idx = txt.indexOf(MARK);
      if (idx === -1) return;
      // content after marker (allow optional space)
      let content = txt.slice(idx + MARK.length);
      if (content.startsWith(' ')) content = content.slice(1);
      const parent = node.parentNode;
      if (!parent) return;
      // Insert text before the marker if any
      const before = txt.slice(0, idx);
      if (before) parent.insertBefore(document.createTextNode(before), node);
      // Create the span for auto description
      const span = document.createElement('span');
      span.className = 'desc--auto';
      span.textContent = content;
      parent.insertBefore(span, node);
      // Remove original text node
      parent.removeChild(node);
    });
  }
  function runOnce() {
    transformMarkers(document.getElementById('menuAccordions') || document.body);
    applyLangClass();
  }
  // Run on load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', runOnce);
  } else {
    runOnce();
  }
  // Observe DOM changes and re-apply
  const target = document.getElementById('menuAccordions') || document.body;
  const mo = new MutationObserver(() => {
    transformMarkers(target);
    applyLangClass();
  });
  mo.observe(target, { childList: true, subtree: true, characterData: true });
  // Also poll language switching
  setInterval(applyLangClass, 500);
})();
</script>


<script>
(function(){
  function triggerLangUpdate(){ try{ if (window.applyLangClass) window.applyLangClass(); }catch(e){} }
  window.addEventListener('hashchange', () => setTimeout(triggerLangUpdate, 150));
  document.addEventListener('visibilitychange', () => setTimeout(triggerLangUpdate, 150));
  // Some widgets add click handlers on language anchors; we capture clicks globally
  document.addEventListener('click', (e) => {
    const a = e.target.closest('a[href*="#googtrans"]');
    if (a) setTimeout(triggerLangUpdate, 300);
  });
})();
</script>

</body>
</html>
